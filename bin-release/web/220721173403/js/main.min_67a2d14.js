var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function h(t){try{o(n.next(t))}catch(e){s(e)}}function a(t){try{o(n["throw"](t))}catch(e){s(e)}}function o(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(h,a)}o((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,s&&(h=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(h=h.call(s,i[1])).done)return h;switch(s=0,h&&(i=[0,h.value]),i[0]){case 0:case 1:h=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,s=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(h=o.trys,!(h=h.length>0&&h[h.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!h||i[1]>h[0]&&i[1]<h[3])){o.label=i[1];break}if(6===i[0]&&o.label<h[1]){o.label=h[1],h=i;break}if(h&&o.label<h[2]){o.label=h[2],o.ops.push(i);break}h[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(n){i=[6,n],s=0}finally{r=h=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,h,a,o={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Dictionary=function(){function t(){this.items={}}return t.prototype.has=function(t){var e=this.items[t];return null!=e},t.prototype.set=function(t,e){this.items[t]=e},t.prototype["delete"]=function(t){return this.has(t)&&delete this.items[t],!1},t.prototype.get=function(t){return this.has(t)?this.items[t]:void 0},t.prototype.values=function(){var t=[];for(var e in this.items)this.has(e)&&t.push(this.items[e]);return t},t.prototype.clear=function(){for(var t in this.items)this.has(t)&&this["delete"](t)},t}();__reflect(Dictionary.prototype,"Dictionary");var Scene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.Reset=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onComplete.apply(this,t)},e.prototype.createBitmapByName=function(t,e,i,n){return Utility.createBitmapByName(t,e,i,n)},e.prototype.createButton=function(t,e,i,n){return null==n&&(n=!1),Utility.createButton(t,e,i,n)},e.prototype.createTextField=function(t,e,i,n,r,s,h,a){return Utility.createTextField(t,e,i,n,r,s,h,a)},e.prototype.createGif=function(t,e){return Utility.createGif(t,e)},e.prototype.getRandomNum=function(t,e){return Utility.getRandomNum(t,e)},e}(eui.Component);__reflect(Scene.prototype,"Scene");var SceneManager=function(){function t(){this.sceneDic=new Object}return Object.defineProperty(t,"Instance",{get:function(){return null==t._manager&&(t._manager=new t),t._manager},enumerable:!0,configurable:!0}),t.prototype.RegisterScene=function(t,e){e.name=t,this.sceneDic[t]=e},t.prototype.GetCurScene=function(){return this.currentScene},t.prototype.GetPopScene=function(){return this.pop_scene},t.prototype.changeScene=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.sceneDic[t];this.currentScene&&(this.rootLayer.removeChild(this.currentScene),this.currentScene.removeListener()),this.rootLayer.addChild(n),this.currentScene=n,(r=this.currentScene).Reset.apply(r,e),this.currentScene.addListener();var r},t.prototype.pushScene=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.sceneDic[t];this.popScene(),this.pop_scene||(this.rootLayer.addChild(n),this.pop_scene=n,(r=this.pop_scene).Reset.apply(r,e),this.pop_scene.addListener());var r},t.prototype.popScene=function(){this.pop_scene&&(this.rootLayer.removeChild(this.pop_scene),this.pop_scene.removeListener(),this.pop_scene=null)},t}();__reflect(SceneManager.prototype,"SceneManager");var EventID=function(){function t(){}return t.TubeChanged="TubeChanged",t.ThemeChanged="ThemeChanged",t.ThemeBtnClicked="ThemeBtnClicked",t.RefreshLevel="RefreshLevel",t}();__reflect(EventID.prototype,"EventID");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.userInfo]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.userInfo={nickName:"username"},[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]);var WXPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.userInfo]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.userInfo={nickName:"username"},[2]})})},t}();__reflect(WXPlatform.prototype,"WXPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}var h=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},h)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var o=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(o,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},h)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AudioManager=function(){function t(){this.points=[],this._curBGMChannel=null;for(var t=10,e=0;t>e;e++){var i=new egret.Point(0,0);this.PushPoint(i)}}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),t.prototype.PopPoint=function(){var t=this.points.pop();return null==t?t=new egret.Point:(t.x=0,t.y=0),t},t.prototype.PushPoint=function(t){this.points.push(t)},t.prototype.PlaySound=function(t,e){var i=this;if(void 0===e&&(e=0),0!=PlayerData.Instance.soundOn){var n=RES.getRes(t);if(null!=n){var r=n.play(0,1);if(e>0){var s=this.PopPoint();egret.Tween.get(s).to({x:1},e).call(function(){console.log("sound time Over"),r.stop(),egret.Tween.removeTweens(s),i.PushPoint(s)},this)}r.addEventListener(egret.Event.SOUND_COMPLETE,function(){console.log("sound Complete")},this)}}},t.prototype.PlayBGM=function(t){this.StopBGM();var e=RES.getRes(t);null!=e&&(this._curBGMChannel=e.play(),this._curBGMChannel,0==PlayerData.Instance.bgmOn&&(this.BMGVolume=0))},Object.defineProperty(t.prototype,"BMGVolume",{set:function(t){null!=this._curBGMChannel&&(this._curBGMChannel.volume=t)},enumerable:!0,configurable:!0}),t.prototype.StopBGM=function(){null!=this._curBGMChannel&&(this._curBGMChannel.stop(),delete this._curBGMChannel)},t.instance=null,t}();__reflect(AudioManager.prototype,"AudioManager");var DataConfig=function(){function t(){this.configs=new Dictionary}return Object.defineProperty(t,"Instance",{get:function(){return null==t.instance&&(t.instance=new t),t.instance},enumerable:!0,configurable:!0}),t.prototype.Init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,RES.loadGroup("cfg")];case 1:return t.sent(),this.IniConfigs(),[2]}})})},t.prototype.IniConfigs=function(){this.InitConfig("description","description_json"),this.InitConfig("level","level_json"),this.InitConfig("purchaser","purchaser_json"),this.InitConfig("settings","settings_json"),this.InitConfig("theme","theme_json"),this.InitConfig("tube","tube_json"),this.InitConfig("water","water_json")},t.prototype.InitConfig=function(t,e){var i=RES.getRes(e);this.configs.set(t,i)},t.prototype.GetConfig=function(t){return this.configs.get(t)},t.prototype.GetDataByIndex=function(t,e){var i=this.configs.get(t);return null==i?null:i[e]},Object.defineProperty(t.prototype,"SettingData",{get:function(){return this.GetDataByIndex("settings",0)},enumerable:!0,configurable:!0}),t.instance=null,t}();__reflect(DataConfig.prototype,"DataConfig");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LzyScrollView=function(t){function e(e,i,n,r,s,h,a,o){void 0===o&&(o="");var l=t.call(this)||this;return l.prevIndex=-1,l.prevValue=0,l.nextIndex=-1,l.nextValue=0,l.isVertical=e,l.width=i,l.height=n,l.anchorOffsetX=h,l.anchorOffsetY=a,l.posX=r,l.posY=s,l.x=r,l.y=s,l.bgRes=o,l.items=[],l.usedItems=[],l.once(egret.Event.ADDED_TO_STAGE,l.onAddToStage,l),l}return __extends(e,t),e.prototype.AddBg=function(){if(""!=this.bgRes){var t=new egret.Bitmap,e=RES.getRes(this.bgRes);t.texture=e,t.width=this.width,t.height=this.height,t.touchEnabled=!0,this.addChild(t)}},e.prototype.onAddToStage=function(){this.AddBg(),this.myscrollView=new egret.ScrollView,this.myscrollView.width=this.width,this.myscrollView.height=this.height,this.isVertical?(this.myscrollView.verticalScrollPolicy="on",this.myscrollView.horizontalScrollPolicy="off"):(this.myscrollView.verticalScrollPolicy="off",this.myscrollView.horizontalScrollPolicy="on"),this.addChild(this.myscrollView),this.myscrollView.addEventListener(egret.Event.COMPLETE,this.onComplete,this),this.myscrollView.addEventListener(egret.Event.CHANGE,this.onChange,this)},e.prototype.onComplete=function(t){},e.prototype.onChange=function(t){if(null!=this.datas){var e=this.datas.length;if(0!=e){var i=this.isVertical?t.currentTarget.scrollTop:t.currentTarget.scrollLeft,n=0+i,r=this.height+i;if(this.prevIndex>0&&this.prevValue>=n){for(var s=this.prevIndex-this.linePerCount,h=this.creater.width(),a=this.creater.height(),o=this.prevIndex;o>s;o--){var l=this.datas[o],c=this.CalTargetXY(o);this.ShowGrid(c.x,c.y,o,l)}var u=this.isVertical?a+this.spacingY:h+this.spacingX;this.prevValue-=u,this.prevIndex=s}if(this.nextIndex>0&&this.nextIndex<e&&this.nextValue<=r){for(var d=this.nextIndex+this.linePerCount,h=this.creater.width(),a=this.creater.height(),o=this.nextIndex;d>o;o++)if(!(o>=e)){var l=this.datas[o];if(null!=l){var g=this.CalTargetXY(o);this.ShowGrid(g.x,g.y,o,l)}}var u=this.isVertical?a+this.spacingY:h+this.spacingX;this.nextValue+=u,this.nextIndex=d}var p=this.prevIndex+1,f=this.nextIndex-1;0>p&&(p=0),f>e-1&&(f=e-1);var m=this.CalTargetXY(p),y=this.CalTargetXY(f),v=this.isVertical?m.y+this.creater.height():m.x+this.creater.width(),C=this.isVertical?y.y:y.x;if(n>v){for(var S=p+this.linePerCount,o=p;S>o;o++)this.HideGrid(o);this.prevIndex=S-1,this.prevValue=v}if(C>r){for(var B=f-this.linePerCount,o=f;o>B;o--)this.HideGrid(o);this.nextIndex=B+1,this.nextValue=C}}}},e.prototype.SetContent=function(t,e,i,n,r,s){if(void 0===r&&(r=0),void 0===s&&(s=0),null==n)return void console.error("creater is null");if(null!=this.creater&&n!=this.creater)return void console.error("creater is not equals");if(this.creater=n,this.datas=i,this.spacingX=t,this.spacingY=e,this.paddingX=r,this.paddingY=s,null==this._content){this._content=new egret.DisplayObjectContainer;var h=Utility.createBitmapByName("empty_png",0,0);h.name="contentBG",this._content.addChild(h),this.myscrollView.setContent(this._content)}for(var a=this.usedItems.length,o=a-1;o>=0;o--){var l=this.usedItems.pop();null!=l&&(this.ReleaseGridToPool(l),this._content.removeChild(l))}if(this.isVertical){this.myscrollView.scrollTop=0,this._content.width=this.width;var c=n.width(),u=n.height(),d=(this.width-r+t)/(c+t);d=Math.floor(d),0==d&&(d=1),this.linePerCount=d;var g=i.length,p=g/d;p=Math.ceil(p);var f=s+(u+e)*p;this._content.height=f,this.prevIndex=-1,this.nextIndex=-1;for(var m=0;m<i.length;m++){var y=i[m],v=this.CalTargetXY(m),C=v.x,S=v.y;if(S>this.height){this.nextIndex=m,this.nextValue=S;break}this.ShowGrid(C,S,m,y)}}else{this._content.height=this.height,this.myscrollView.scrollLeft=0;var c=n.width(),u=n.height(),B=(this.height-s+e)/(u+e);B=Math.floor(B),0==B&&(B=1),this.linePerCount=B;var g=i.length,T=g/B;T=Math.ceil(T);var b=r+(c+t)*T;this._content.width=b,this.prevIndex=-1,this.nextIndex=-1;for(var m=0;m<i.length;m++){var y=i[m],v=this.CalTargetXY(m),C=v.x,S=v.y;if(C>this.width){this.nextIndex=m,this.nextValue=C;break}this.ShowGrid(C,S,m,y)}}var w=this._content.getChildByName("contentBG");w.width=this._content.width,w.height=this._content.height},e.prototype.CalTargetXY=function(t){var e=t%this.linePerCount,i=Math.floor(t/this.linePerCount),n=this.isVertical?e:i,r=this.isVertical?i:e,s=this.paddingX+n*(this.creater.width()+this.spacingX),h=this.paddingY+r*(this.creater.height()+this.spacingY);return new Vector2(s,h)},e.prototype.HideGrid=function(t){console.log("HideGrid",t);var e=this._content.getChildByName(String(t));if(null!=e){var i=this.usedItems.indexOf(e);i>=0&&this.usedItems.splice(i,1),this.ReleaseGridToPool(e),this._content.removeChild(e)}},e.prototype.ShowGrid=function(t,e,i,n){console.log("ShowGrid",i);var r=this.GetGridInPool();r.name=String(i),r.x=t,r.y=e,r.width=this.creater.width(),r.height=this.creater.height(),this._content.addChild(r),this.creater.InitDataUI(r,n),this.usedItems.push(r)},e.prototype.UpdateByIndex=function(t,e,i){var n=this._content.getChildAt(t);i.InitDataUI(n,e)},e.prototype.GetGridInPool=function(){var t=this.items.pop();return null==t&&(t=new egret.DisplayObjectContainer),t},e.prototype.ReleaseGridToPool=function(t){this.items.push(t)},e}(egret.DisplayObjectContainer);__reflect(LzyScrollView.prototype,"LzyScrollView");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isUserTouch=!1,e.isResLoaded=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return SceneManager.ScreenWidth=this.stage.stageWidth,SceneManager.ScreenHeight=this.stage.stageHeight,this.checkUserClick(),[4,this.loadResource()];case 1:return e.sent(),[4,DataConfig.Instance.Init()];case 2:return e.sent(),this.CheckMusicCanPlay(),this.Init(),[4,platform.login()];case 3:return e.sent(),[4,platform.getUserInfo()];case 4:return t=e.sent(),console.log(t),[2]}})})},e.prototype.checkUserClick=function(){var t=this,e=function(){t.isUserTouch=!0,t.CheckMusicCanPlay(),t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,t)};e=e.bind(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},e.prototype.CheckMusicCanPlay=function(){this.isUserTouch&&this.isResLoaded&&AudioManager.Instance.PlayBGM("BGM_wav")},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,8,,9]),this.isResLoaded=!1,[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("loading",1)];case 2:return i.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("theme",0,t)];case 3:return i.sent(),[4,RES.loadGroup("tube",0,t)];case 4:return i.sent(),[4,RES.loadGroup("ui",0,t)];case 5:return i.sent(),[4,RES.loadGroup("gif",0,t)];case 6:return i.sent(),[4,RES.loadGroup("music",0,t)];case 7:return i.sent(),this.stage.removeChild(t),this.isResLoaded=!0,[3,9];case 8:return e=i.sent(),console.error(e),[3,9];case 9:return[2]}})})},e.prototype.Init=function(){SceneManager.Instance.rootLayer=this,this.addEventListener(egret.Event.ENTER_FRAME,this.Update,this),SceneManager.Instance.RegisterScene("StartScene",new StartScene),SceneManager.Instance.RegisterScene("GameScene",new GameScene),SceneManager.Instance.RegisterScene("PauseScene",new PauseScene),SceneManager.Instance.RegisterScene("ResultScene",new ResultScene),SceneManager.Instance.RegisterScene("ShopScene",new ShopScene),SceneManager.Instance.RegisterScene("SelectLevelScene",new SelectLevelScene),SceneManager.Instance.RegisterScene("RankScene",new RankScene),SceneManager.Instance.changeScene("StartScene"),this.Test()},e.prototype.Test=function(){},e.prototype.onPostComplete=function(t){var e=t.currentTarget;console.log("post data : ",e.response);var i=new egret.TextField;i.size=18,i.text="POST response:\n"+e.response.substring(0,50)+"...",this.addChild(i),i.x=300,i.y=70},e.prototype.onPostIOError=function(t){console.log("post error : "+t)},e.prototype.onPostProgress=function(t){console.log("post progress : "+Math.floor(100*t.bytesLoaded/t.bytesTotal)+"%")},e.prototype.ab2str=function(t,e){var i=new Blob([t]),n=new FileReader;n.readAsText(i,"utf-8"),n.onload=function(){e&&e.call(null,n.result)}},e.prototype.str2ab=function(t,e){var i=new Blob([t],{type:"text/plain"}),n=new FileReader;n.readAsArrayBuffer(i),n.onload=function(){e&&e.call(null,n.result)}},e.prototype.Update=function(){null!=SceneManager.Instance.GetCurScene()&&SceneManager.Instance.GetCurScene().Update(),null!=SceneManager.Instance.GetPopScene()&&SceneManager.Instance.GetPopScene().Update()},e.prototype.onRotation=function(t){0==t?(SceneManager.ScreenWidth=this.stage.stageWidth,SceneManager.ScreenHeight=this.stage.stageHeight):(SceneManager.ScreenWidth=this.stage.stageWidth,SceneManager.ScreenHeight=this.stage.stageHeight)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var SHA1=function(){function t(){this.hexcase=0,this.b64pad=""}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.hex_sha1=function(t){return this.rstr2hex(this.rstr_sha1(this.str2rstr_utf8(t)))},t.prototype.b64_sha1=function(t){return this.rstr2b64(this.rstr_sha1(this.str2rstr_utf8(t)))},t.prototype.any_sha1=function(t,e){return this.rstr2any(this.rstr_sha1(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_sha1=function(t,e){return this.rstr2hex(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_sha1=function(t,e){return this.rstr2b64(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_sha1=function(t,e,i){return this.rstr2any(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.prototype.sha1_vm_test=function(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==this.hex_sha1("abc").toLowerCase()},t.prototype.rstr_sha1=function(t){return this.binb2rstr(this.binb_sha1(this.rstr2binb(t),8*t.length))},t.prototype.rstr_hmac_sha1=function(t,e){var i=this.rstr2binb(t);i.length>16&&(i=this.binb_sha1(i,8*t.length));for(var n=Array(16),r=Array(16),s=0;16>s;s++)n[s]=909522486^i[s],r[s]=1549556828^i[s];var h=this.binb_sha1(n.concat(this.rstr2binb(e)),512+8*e.length);return this.binb2rstr(this.binb_sha1(r.concat(h),672))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",s=0;s<t.length;s++)i=t.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(15&i);return r},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=t.length,s=0;r>s;s+=3)for(var h=t.charCodeAt(s)<<16|(r>s+1?t.charCodeAt(s+1)<<8:0)|(r>s+2?t.charCodeAt(s+2):0),a=0;4>a;a++)n+=8*s+6*a>8*t.length?this.b64pad:i.charAt(h>>>6*(3-a)&63);return n},t.prototype.rstr2any=function(t,e){var i,n,r,s,h=e.length,a=Array(),o=Array(Math.ceil(t.length/2));for(i=0;i<o.length;i++)o[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);for(;o.length>0;){for(s=Array(),r=0,i=0;i<o.length;i++)r=(r<<16)+o[i],n=Math.floor(r/h),r-=n*h,(s.length>0||n>0)&&(s[s.length]=n);a[a.length]=r,o=s}var l="";for(i=a.length-1;i>=0;i--)l+=e.charAt(a[i]);var c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2)));for(i=l.length;c>i;i++)l=e[0]+l;return l},t.prototype.str2rstr_utf8=function(t){for(var e,i,n="",r=-1;++r<t.length;)e=t.charCodeAt(r),i=r+1<t.length?t.charCodeAt(r+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),r++),127>=e?n+=String.fromCharCode(e):2047>=e?n+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n},t.prototype.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.prototype.rstr2binb=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<24-i%32;return e},t.prototype.binb2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>24-i%32&255);return e},t.prototype.binb_sha1=function(t,e){t[e>>5]|=128<<24-e%32,t[(e+64>>9<<4)+15]=e;for(var i=Array(80),n=1732584193,r=-271733879,s=-1732584194,h=271733878,a=-1009589776,o=0;o<t.length;o+=16){for(var l=n,c=r,u=s,d=h,g=a,p=0;80>p;p++){16>p?i[p]=t[o+p]:i[p]=this.bit_rol(i[p-3]^i[p-8]^i[p-14]^i[p-16],1);var f=this.safe_add(this.safe_add(this.bit_rol(n,5),this.sha1_ft(p,r,s,h)),this.safe_add(this.safe_add(a,i[p]),this.sha1_kt(p)));a=h,h=s,s=this.bit_rol(r,30),r=n,n=f}n=this.safe_add(n,l),r=this.safe_add(r,c),s=this.safe_add(s,u),h=this.safe_add(h,d),a=this.safe_add(a,g)}return[n,r,s,h,a]},t.prototype.sha1_ft=function(t,e,i,n){return 20>t?e&i|~e&n:40>t?e^i^n:60>t?e&i|e&n|i&n:e^i^n},t.prototype.sha1_kt=function(t){return 20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514},t.prototype.safe_add=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(SHA1.prototype,"SHA1");var Utility=function(){function t(){}return t.write=function(t,e){e&&(e=JSON.stringify(e)),egret.localStorage.setItem(t,e)},t.read=function(t){var e=egret.localStorage.getItem(t);return e&&"undefined"!=e&&"null"!=e?JSON.parse(e):null},t.JsonEncode=function(t){return JSON.stringify(t)},t.JsonDecode=function(t){return JSON.parse(t)},t.JsonDecode2=function(t){return JSON.parse(t)},t.getRandomNum=function(t,e){var i=e-t,n=Math.random();return t+Math.round(n*i)},t.createBitmapByName=function(t,e,i,n){var r=new egret.Bitmap,s=RES.getRes(t);return r.texture=s,null!=e&&(r.width=e),null!=i&&(r.height=i),null!=n&&n&&(r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2),r},t.createButton=function(e,i,n,r){var s=new egret.DisplayObjectContainer;s.width=i,s.height=n,r&&(s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2);var h=t.createBitmapByName(e);return h.fillMode=egret.BitmapFillMode.SCALE,h.name="btnBg",h.width=i,h.height=n,s.addChild(h),s},t.createTextField=function(t,e,i,n,r,s,h,a){var o=new egret.TextField;return o.width=t,o.height=e,o.textColor=i,o.size=null==n?30:n,o.fontFamily=null==s?"myFirstFont":s,o.text=null==r?"":r,o.textAlign=null==h?egret.HorizontalAlign.LEFT:h,o.verticalAlign=null==a?egret.VerticalAlign.MIDDLE:a,o},Object.defineProperty(t,"NotiBoxGo",{get:function(){if(null==t._notibox){t._notibox=new egret.DisplayObjectContainer,t._notibox.width=200,t._notibox.height=50,t._notibox.anchorOffsetX=t._notibox.width/2,t._notibox.anchorOffsetY=t._notibox.height/2,t._notibox.x=0,t._notibox.y=0,t._notibox.alpha=0;var e=t.createBitmapByName("tog3_png");t.setImageColor(e,0),e.name="BG",e.fillMode=egret.BitmapFillMode.REPEAT,e.width=t._notibox.width,e.height=t._notibox.height,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=0,e.y=0,t._notibox.addChild(e);var i=new egret.TextField;i.name="Text",i.text="text",i.fontFamily="myFirstFont",i.textColor=16777215,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.width=t._notibox.width,i.height=t._notibox.height,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=0,i.y=0,i.size=30,t._notibox.addChild(i),SceneManager.Instance.rootLayer.addChild(t._notibox)}return t._notibox},enumerable:!0,configurable:!0}),t.showNotiBox=function(e){var i=t.NotiBoxGo;if(!(i.alpha>0)){var n=i.getChildByName("BG");n.width=30*e.length;var r=0,s=80,h=i.getChildByName("Text");h.width=n.width,h.text=e,i.alpha=0,i.x=SceneManager.ScreenWidth/2,i.y=r;var a=egret.Tween.get(i);a.wait(100),a.to({alpha:1,y:s},500),a.wait(1e3),a.to({alpha:0,y:r},500)}},Object.defineProperty(t,"EmptyGo",{get:function(){return null==t._empty&&(t._empty=new egret.DisplayObjectContainer,t._empty.width=50,t._empty.height=50,t._empty.x=0,t._empty.y=0),t._empty},enumerable:!0,configurable:!0}),t.Float=function(e,i,n,r,s){var h=t.EmptyGo;h.x=e;var a=function(){var t=h.x;r.bind(s)(t)},o=egret.Tween.get(h,{loop:!1,onChange:a,onChangeObj:s});o.to({x:i},n)},t.ButtonActive=function(e,i){if(e.touchEnabled=i,i){var n=function(){var t=egret.Tween.get(e);t.to({scaleX:.9,scaleY:.9},50).to({scaleX:1,scaleY:1},50)};n.bind(e),t.btnScaleFuns.set(e,n),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e)}else{var n=t.btnScaleFuns.get(e);e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e)}},t.ButtonActive2=function(e,i){if(e.touchEnabled=i,i){var n=function(){var t=egret.Tween.get(e);t.to({scaleX:.9,scaleY:.9},50).to({scaleX:1,scaleY:1},50)};n.bind(e),t.btnScaleFuns.set(e,n),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e)}else{var n=t.btnScaleFuns.get(e);e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e)}},t.Str2Int=function(t){return"0"==t?0:"1"==t?1:"2"==t?2:"3"==t?3:"4"==t?4:"5"==t?5:"6"==t?6:"7"==t?7:"8"==t?8:"9"==t?9:"A"==t?10:"B"==t?11:"C"==t?12:"D"==t?13:"E"==t?14:"F"==t?15:0},t.ColorHTMLToInt=function(e){var i,n,r,s,h,a,o=new String(e);"#"==o.charAt(0)?(i=t.Str2Int(o.charAt(1)),n=t.Str2Int(o.charAt(2)),r=t.Str2Int(o.charAt(3)),s=t.Str2Int(o.charAt(4)),h=t.Str2Int(o.charAt(5)),a=t.Str2Int(o.charAt(6))):(i=t.Str2Int(o.charAt(0)),n=t.Str2Int(o.charAt(1)),r=t.Str2Int(o.charAt(2)),s=t.Str2Int(o.charAt(3)),h=t.Str2Int(o.charAt(4)),a=t.Str2Int(o.charAt(5)));var l=16*i+n,c=16*r+s,u=16*h+a;return 256*l*256+256*c+u},t.setImageColor=function(t,e){var i=function(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e},n=i(e),r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];r[0]=n.r/255,r[6]=n.g/255,r[12]=n.b/255;var s=new egret.ColorMatrixFilter(r);t.filters=[s]},t.createGif=function(t,e){var i=RES.getRes(t),n=RES.getRes(e),r=new egret.MovieClipDataFactory(i,n),s=new egret.MovieClip(r.generateMovieClipData());return s},t.setGifColor=function(t,e){var i=function(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e},n=i(e),r=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];r[0]=n.r/255,r[6]=n.g/255,r[12]=n.b/255;var s=new egret.ColorMatrixFilter(r);t.filters=[s]},t.getRandomColor=function(){return(Math.floor(255*Math.random())<<16)+(Math.floor(255*Math.random())<<8)+Math.floor(255*Math.random())},t.Lerp=function(t,e,i){var n=t+(e-t)*i;return n},Object.defineProperty(t,"Deg2Rad",{get:function(){return Math.PI/180},enumerable:!0,configurable:!0}),t._notibox=null,t._empty=null,t.btnScaleFuns=new Dictionary,t}();__reflect(Utility.prototype,"Utility");var EventEntity=function(){function t(t,e,i){this.func=t,this.thisObj=e,this.eventName=i}return t}();__reflect(EventEntity.prototype,"EventEntity");var EventCenter=function(){function t(){}return t.AddListener=function(e,i,n){var r=new EventEntity(i,n,e);t.entityList.push(r)},t.RemoveListener=function(e,i,n){for(var r=t.entityList.length,s=r-1;s>=0;s--){var h=t.entityList[s];h.func==i&&h.eventName==e&&h.thisObj==n&&t.entityList.splice(s,1)}},t.RemoveAllListeners=function(e){for(var i=t.entityList.length,n=i-1;n>=0;n--){var r=t.entityList[n];r.thisObj==e&&t.entityList.splice(n,1)}},t.Notify=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var r=t.entityList.length,s=r-1;s>=0;s--){var h=t.entityList[s];if(null!=h&&h.eventName==e){var a=h.func;a.bind(h.thisObj).apply(void 0,i)}}},t.entityList=[],t}();__reflect(EventCenter.prototype,"EventCenter");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.bg=Utility.createBitmapByName("loading_bg_jpg"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg),this.textField=new egret.TextField,this.textField.x=100,this.textField.y=.75*SceneManager.ScreenHeight,this.textField.width=480,this.textField.height=100,this.textField.fontFamily="myFirstFont",this.textField.textAlign="center",this.addChild(this.textField)},e.prototype.onProgress=function(t,e,i){this.textField.text="Loading..."+t+"/"+e+"/"+i.name},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var GameUtil=function(){function t(){}return t.ParseLevelCfg=function(t){for(var e=[],i=t.split(";"),n=i.length,r=0;n>r;r++){e[r]=[];for(var s=i[r],h=s.split(","),a=-1,o=3;o>=0;o--){var l=h[o];null==l&&(l="0");var c=Number(l);if(c!=a){var u=new WaterData(c);e[r].push(u)}else{var d=e[r].length-1;e[r][d].num+=1}a=c}}return e},t.createDiamonLayout=function(t,e){var i=new egret.DisplayObjectContainer;i.width=180,i.height=40;var n=Utility.createBitmapByName("di_png");n.fillMode=egret.BitmapFillMode.SCALE,n.width=i.width,n.height=i.height,i.addChild(n);var r=20,s=Utility.createBitmapByName(t);s.name="diamonIcon",s.width=64,s.height=64,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=r,s.y=i.height/2,i.addChild(s);var h=new egret.TextField;h.name="diamonTxt",h.text=String(e),h.fontFamily="myFirstFont",h.textColor=16777215,h.textAlign=egret.HorizontalAlign.LEFT,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.width=i.width-s.width,h.height=i.height,h.x=s.width/2+r,h.y=0,h.size=36,h=h;var a=h.textWidth;return h.width=a,i.width=s.width/2+r+h.width,i.addChild(h),i},t.changeDiamonIconAndNum=function(t,e,i){var n=t.getChildByName("diamonIcon");null!=n&&(n.texture=RES.getRes(e));var r=t.getChildByName("diamonTxt");if(null!=r){r.text=String(i);var s=r.textWidth;r.width=s;var h=20;t.width=n.width/2+h+r.width}},t.diamonFly=function(t,e,i){},t.ShowNotibox=function(t){Utility.showNotiBox(t)},t}();__reflect(GameUtil.prototype,"GameUtil");var PlayerData=function(){function t(){this.noAds=!1,this.curTubeID=1,this.curThemeID=18,this.backNum=5,this.newTubeNum=2,this.tubes=[1],this.themes=[15],this.diamon=2e3,this.diamon2=0,this.curLevel=1,this.curLevel2=1,this.process=10,this.bgmOn=!0,this.soundOn=!0}return Object.defineProperty(t,"Instance",{get:function(){return null==t._manager&&(t._manager=new t),t._manager},enumerable:!0,configurable:!0}),t.prototype.SetUserInfo=function(t){this.userInfo=t},t.prototype.SetGameInfo=function(t){this.noAds=t.noAds,this.curTubeID=t.curTubeID,this.curThemeID=t.curThemeID,this.backNum=t.backNum,this.newTubeNum=t.newTubeNum,this.tubes=t.tubes,this.themes=t.themes,this.diamon=t.diamon,this.curLevel=t.curLevel
},t.prototype.SetSettingInfo=function(t){},t.prototype.Save=function(){},t.prototype.GetCurLevel=function(t){var e=1;return t==GameType.Normal?e=this.curLevel:t==GameType.Difficult&&(e=this.curLevel2),e},t.prototype.GetDiamons=function(t){var e=0;return t==GameType.Normal?e=this.diamon:t==GameType.Difficult&&(e=this.diamon2),e},t.prototype.CurLevelAdd=function(t){t==GameType.Normal?this.curLevel=this.curLevel+1:t==GameType.Difficult&&(this.curLevel2=this.curLevel2+1),this.Save()},t.prototype.isTubeContains=function(t){if(null==this.tubes)return!1;if(0==this.tubes.length)return!1;for(var e=this.tubes.length,i=0;e>i;i++)if(this.tubes[i]==t)return!0;return!1},t.prototype.isThemeContains=function(t){if(null==this.themes)return!1;if(0==this.themes.length)return!1;for(var e=this.themes.length,i=0;e>i;i++)if(this.themes[i]==t)return!0;return!1},t.prototype.DealEffect=function(t,e){1==t||2==t||3==t||4==t||5==t||console.error("unkown effectType")},t.prototype.BuyItem=function(t){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(n){return e=new Promise(function(e,n){var r=DataConfig.Instance.GetDataByIndex("purchaser",t);null==r&&(GameUtil.ShowNotibox("未知的购买配置"),n(!1));var s=(r.CostType,r.Cost),h=r.Effect,a=r.Num;1==r.CostType?e(!0):2==r.CostType?i.diamon>=s?(i.diamon-=s,i.DealEffect(h,a),e(!0)):(GameUtil.ShowNotibox("钻石不够，无法购买"),n(!1)):3==r.CostType?i.diamon2>=s?(i.diamon2-=s,i.DealEffect(h,a),e(!0)):(GameUtil.ShowNotibox("点券不够，无法购买"),n(!1)):(GameUtil.ShowNotibox("未知的购买参数"),n(!1))}),[2,e]})})},t.prototype.BuyTube=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.BuyTheme=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(PlayerData.prototype,"PlayerData");var PullDir;!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(PullDir||(PullDir={}));var TubeScript=function(t){function e(){var e=t.call(this)||this;return e.tubeWidth=80,e.tubeHeight=308,e.tubeSlash=318,e.waterWidth=80,e.waterHeight=66,e.tubeMouthWidth=80,e.flowLength=450,e.onPullInComplete=null,e.pullInObj=null,e._pullDir=PullDir.Left,e.pullTweener=null,e.PullStartTime=.4,e.PullTimes=[.72,1.26,1.92,2.52],e.PullEndTime=.4,e.selectHeight=69,e.InitParams(),e.InitUI(),e.RefreshTubeType(),e.addListener(),e.touchEnabled=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"MaxWaterNum",{get:function(){return 4},enumerable:!0,configurable:!0}),e.prototype.TestFlow=function(t){if(null!=this.waterUIScripts&&0!=this.waterUIScripts.length)for(var e=this.waterUIScripts.length,i=0;e>i;i++)t?this.waterUIScripts[i].SetFlow():this.waterUIScripts[i].SetFull()},Object.defineProperty(e.prototype,"PullAngles",{get:function(){return[90,75,60,45,30]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pullDir",{get:function(){return this._pullDir},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TopWaterData",{get:function(){if(null==this.waterUIScripts||0==this.waterUIScripts.length)return null;var t=this.waterUIScripts.length;return this.waterUIScripts[t-1].waterData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"TopWater",{get:function(){if(null==this.waterUIScripts||0==this.waterUIScripts.length)return null;var t=this.waterUIScripts.length;return this.waterUIScripts[t-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CurTotalWaterNum",{get:function(){var t=0;if(null==this.waterUIScripts||0==this.waterUIScripts.length)return 0;for(var e=0;e<this.waterUIScripts.length;e++){var i=this.waterUIScripts[e].waterData;t+=i.num}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"PullTargetPos",{get:function(){var t=this.x,e=this.y;return t+=this.waterWidth/2,e=e+this.tubeHeight-this.flowLength-5,new Vector2(t,e)},enumerable:!0,configurable:!0}),e.prototype.InitParams=function(){this.tubeSlash=Math.sqrt(this.tubeWidth*this.tubeWidth+this.tubeHeight*this.tubeHeight),this.waterWidth=this.tubeWidth,this.PullStartTime=DataConfig.Instance.SettingData.PullStartTime,this.PullTimes[0]=DataConfig.Instance.SettingData.PullTime1,this.PullTimes[1]=DataConfig.Instance.SettingData.PullTime2,this.PullTimes[2]=DataConfig.Instance.SettingData.PullTime3,this.PullTimes[3]=DataConfig.Instance.SettingData.PullTime4,this.PullEndTime=DataConfig.Instance.SettingData.PullEndTime,this.InitPivotPosition()},e.prototype.InitUI=function(){this.width=this.tubeWidth,this.height=this.tubeHeight;var t=Utility.createBitmapByName("pz_di_bt_1_2_png");t.fillMode=egret.BitmapFillMode.SCALE,t.width=80,t.height=302,this.waterMask=t,this.addChild(t);var e=new egret.DisplayObjectContainer;e.width=80,e.height=302,this.waterContainer=e,this.waterContainer.mask=t,this.addChild(e);var i=Utility.createBitmapByName("pz_di_bt_1_1_png");i.fillMode=egret.BitmapFillMode.SCALE,i.width=80,i.height=302,this.tubeFG=i,this.addChild(i);var n=Utility.createBitmapByName("white_jpg");n.fillMode=egret.BitmapFillMode.SCALE,n.width=5,n.height=this.flowLength,n.alpha=0,this.waterFlow=n,this.addChild(n)},e.prototype.SetPullInComplete=function(t,e){this.onPullInComplete=t,this.pullInObj=e},e.prototype.DoPullInComplete=function(t){null!=this.onPullInComplete&&this.onPullInComplete.bind(this.pullInObj)(t)},e.prototype.Init=function(t){this.waterUIScripts=[];for(var e=0;e<t.length;e++){var i=t[e];if(0==i.orginId)return;var n=new WaterScript;if(n.Init(this,i),0==e)n.SetPos(this.tubeWidth/2,this.tubeHeight);else{var r=this.waterUIScripts[e-1],s=r.GetPos();n.SetPos(s.x,s.y-r.RealHeight)}this.waterUIScripts.push(n)}this.CloseHideImage()},e.prototype.EnqueueWater=function(t,e){null==e&&(e=!0);var i=null;if(0==this.waterUIScripts.length)i=new WaterScript,i.Init(this,t),i.SetPos(this.tubeWidth/2,this.tubeHeight),this.waterUIScripts.push(i),e&&i.SetSize(this.waterWidth,0);else{var n=this.waterUIScripts.length,r=this.waterUIScripts[n-1];r.waterData.colorInt==t.colorInt?(r.waterData.num+=t.num,i=r):(i=new WaterScript,i.Init(this,t),i.SetPos(this.tubeWidth/2,r.GetPos().y-r.RealHeight),this.waterUIScripts.push(i),e&&i.SetSize(this.waterWidth,0))}return i},e.prototype.DequeueWater=function(){if(null==this.waterUIScripts||0==this.waterUIScripts.length)return null;var t=this.waterUIScripts.pop();return t},e.prototype.isEmpty=function(){return null==this.waterUIScripts||0==this.waterUIScripts.length},e.prototype.isPullIn=function(){if(this._isPullIn)return!0;for(var t=0;t<this.waterUIScripts.length;t++)if(null!=this.waterUIScripts[t].pullInTweener)return!0;return!1},e.prototype.isPullOut=function(){return this._isPullOut?!0:null!=this.pullTweener?!0:!1},e.prototype.canSelect=function(){return this.isEmpty()?!1:this.isPullIn()?!1:this.isPullOut()?!1:!0},e.prototype.Select=function(){if(null!=e.selectTweener)return!1;var t=this.parent.$children.length;this.parent.setChildIndex(this,t-1);var i=this.pullDir2Position.get(PullDir.Left),n=new Vector2(0,this.selectHeight),r=new Vector2(i.x+n.x,i.y-n.y);return e.selectTweener=egret.Tween.get(this),e.selectTweener.to({x:r.x,y:r.y},100).call(function(){e.selectTweener=null},this),!0},e.prototype.UnSelect=function(){if(null!=e.selectTweener)return!1;var t=this.pullDir2Position.get(PullDir.Left);return e.selectTweener=egret.Tween.get(this),e.selectTweener.to({x:t.x,y:t.y},100).call(function(){e.selectTweener=null},this),!0},e.prototype.canPull=function(t){if(0==this.canSelect())return!1;if(null!=this.pullTweener)return!1;if(null!=t.pullTweener)return!1;if(t.CurTotalWaterNum==t.MaxWaterNum)return!1;if(0==t.isEmpty()){var e=this.TopWaterData,i=t.TopWaterData;if(e.colorInt!=i.colorInt)return!1}return!0},e.prototype.pullTotalTime=function(t){return this.PullStartTime+this.PullTimes[t-1]+this.PullEndTime},e.prototype.canPullNum=function(t){var e=t.MaxWaterNum-t.CurTotalWaterNum,i=this.TopWaterData.num,n=i;return i>e&&(n=e),n},e.prototype.Pull=function(t){function e(){var t=this.rotation;this.PullRotate(t)}var i=this;if(0!=this.canSelect()){egret.Tween.removeTweens(this),this._isPullOut=!0,t._isPullIn=!0;var n=this.x,r=t.x;r>n?this._pullDir=PullDir.Right:this._pullDir=PullDir.Left;var s=t.PullTargetPos,h=(new Vector2(this.x,this.y),0);h=this._pullDir==PullDir.Right?this.tubeWidth/2+this.tubeMouthWidth/2:this.tubeWidth/2-this.tubeMouthWidth/2;var a=this.anchorOffsetX,o=h-a;this.anchorOffsetX+=o,this.x+=o;var l=new Vector2(this.x,this.y),c=this.CurTotalWaterNum,u=t.MaxWaterNum-t.CurTotalWaterNum,d=this.TopWaterData.num,g=d;d>u&&(g=u);var p=c-g;this._pullDir==PullDir.Left?(this._startPullAngle=-this.PullAngles[c],this._endPullAngle=-this.PullAngles[p]):(this._startPullAngle=this.PullAngles[c],this._endPullAngle=this.PullAngles[p]);var f=this.waterUIScripts[this.waterUIScripts.length-1];f.SetFlow(),this.SetHideTextActive(!1),this.pullTweener=egret.Tween.get(this,{loop:!1,onChange:e,onChangeObj:this}),this.pullTweener.to({x:s.x,y:s.y,rotation:this._startPullAngle},1e3*this.PullStartTime),this.pullTweener.call(function(){function e(){var t=this.rotation;this.PullRotate(t,n)}i.SetFlowHeight(t);var n=null,r=null;g==d?(n=i.DequeueWater(),r=t.EnqueueWater(n.waterData)):(n=i.TopWater,r=t.TopWater,n.waterData.num-=g,r.waterData.num+=g);var s=i.PullTimes[g-1];r.DealPullIn(s),AudioManager.Instance.PlaySound("pourWater_wav",1e3*s),i._pullDir==PullDir.Left?(i.waterFlow.x=i.tubeWidth/2-i.tubeMouthWidth/2,i.waterFlow.y=0):(i.waterFlow.x=i.tubeWidth/2+i.tubeMouthWidth/2,i.waterFlow.y=0),i.waterFlow.alpha=1,Utility.setImageColor(i.waterFlow,n.waterData.color),i.pullTweener=egret.Tween.get(i,{loop:!1,onChange:e,onChangeObj:i}),i.pullTweener.to({rotation:i._endPullAngle},1e3*s),i.pullTweener.call(function(){function e(){var t=this.rotation;this.PullRotate(t)}g==d?n.Destroy():n.SetFull(),i.waterFlow.alpha=0;var r=new Vector2(l.x,l.y+i.selectHeight);i.pullTweener=egret.Tween.get(i,{loop:!1,onChange:e,onChangeObj:i}),i.pullTweener.to({x:r.x,y:r.y,rotation:0},1e3*i.PullEndTime),i.pullTweener.call(function(){i._isPullOut=!1,t._isPullIn=!1,i.PullRotate(0),i.CloseHideImage(),i.anchorOffsetX=0,i.anchorOffsetY=0;var e=i.pullDir2Position.get(PullDir.Left);i.x=e.x,i.y=e.y,i.SetHideTextActive(!0),i.pullTweener=null},i)},i)},this)}},e.prototype.CloseHideImage=function(){for(var t=this.waterUIScripts.length,e=-1,i=!1,n=-1,r=t-1;r>=0;r--){var s=this.waterUIScripts[r];if(!s.waterData.isHide)break;if(-1==e)s.waterData.isHide=!1,s.CloseHideImg(),e=s.waterData.colorInt;else{if(s.waterData.colorInt!=e)break;s.waterData.isHide=!1,s.CloseHideImg(),i=!0,n=r}}i&&this.RebuildDataAndRefreshUI(n)},e.prototype.RebuildDataAndRefreshUI=function(t){for(var e=this.waterUIScripts.length,i=this.waterUIScripts[t],n=e-1;n>=t+1;n--){var r=this.waterUIScripts[n];i.waterData.num+=r.waterData.num,this.waterUIScripts[n]=null,r.Destroy()}i.RefreshUI()},e.prototype.SetFlowHeight=function(t){var e=this.y,i=t.y+t.tubeHeight,n=t.CurTotalWaterNum,r=n*t.waterHeight,s=i-r,h=Math.abs(s-e);0==n?h-=10:h+=10,this.waterFlow.height=h},e.prototype.PullRotate=function(t,e){if(this.waterFlow.rotation=-t,0==t)for(var i=0;i<this.waterUIScripts.length;i++){var n=this.waterUIScripts[i];if(n.DoRotate(0),n.SetSize(n.width,n.RealHeight),0==i)n.SetPos(this.tubeWidth/2,this.tubeHeight);else{var r=this.waterUIScripts[i-1],s=r.GetPos();n.SetPos(this.tubeWidth/2,s.y-r.RealHeight)}}else{var h=0;if(90>t){var a=Math.abs(t);h=this.tubeWidth/2*Math.tan(a*Utility.Deg2Rad)}for(var o=this.tubeHeight+h,l=0,i=0;i<this.waterUIScripts.length;i++)if(this.waterUIScripts[i]!=e){this.waterUIScripts[i].DoRotate(-t),this.waterUIScripts[i].SetWaterAnchoredPosition(o);var c=this.waterUIScripts[i].RefreshWidthAndHeight(-t);o-=c/Math.cos(t*Utility.Deg2Rad),l+=c}null!=e&&(e.DoRotate(-t),e.SetWaterAnchoredPosition(o),e.SetPullWaterSize(-t,l))}},e.prototype.SetPosition=function(t,e){this.x=t,this.y=e,this.InitPivotPosition()},e.prototype.SetHideTextActive=function(t){for(var e=0;e<this.waterUIScripts.length;e++)this.waterUIScripts[e].SetHideTextActive(t)},e.prototype.RefreshTubeType=function(){var t=PlayerData.Instance.curTubeID,e=PlayerData.Instance.curThemeID,i=DataConfig.Instance.GetDataByIndex("tube",t),n=DataConfig.Instance.GetDataByIndex("theme",e);if(null!=i&&null!=n){if(0==n.tubeFgIndex){var r=RES.getRes(i.fgSprite);this.tubeFG.texture=r}else{var s=RES.getRes(i.fgSprite2);this.tubeFG.texture=s}var h=RES.getRes(i.bgSprite);this.waterMask.texture=h,this.tubeMouthWidth=i.width}},e.prototype.InitPivotPosition=function(){null==this.pullDir2Position?this.pullDir2Position=new Dictionary:this.pullDir2Position.clear();var t=new Vector2(this.x,this.y);this.pullDir2Position.set(PullDir.Left,t),this.pullDir2Position.set(PullDir.Right,new Vector2(t.x+this.tubeWidth,t.y)),null==this.pullDir2MouthPosition?this.pullDir2MouthPosition=new Dictionary:this.pullDir2MouthPosition.clear();var e=new Vector2(t.x+this.tubeWidth/2,t.y);this.pullDir2MouthPosition.set(PullDir.Left,new Vector2(e.x-this.tubeMouthWidth/2,e.y)),this.pullDir2MouthPosition.set(PullDir.Right,new Vector2(e.x+this.tubeMouthWidth/2,e.y))},e.prototype.CheckOneWaterFull=function(){return 1==this.waterUIScripts.length&&this.waterUIScripts[0].waterData.num==this.MaxWaterNum?!0:!1},e.prototype.PlayOneWaterFullEffect=function(){var t=200,e=200;this.effectGo=new egret.DisplayObjectContainer,this.effectGo.width=t,this.effectGo.height=e,this.effectGo.anchorOffsetX=t/2,this.effectGo.anchorOffsetY=e,this.effectGo.x=this.tubeWidth/2,this.effectGo.y=100,this.effectGo.scaleX=2,this.effectGo.scaleY=2;var i=Utility.createGif("lihua_json","lihua_png");i.frameRate=12,i.gotoAndPlay(0,1),i.width=t,i.height=e,this.effectGo.addChild(i),this.addChild(this.effectGo),i.addEventListener(egret.Event.COMPLETE,function(t){this.removeChild(this.effectGo),delete this.effectGo,this.effectGo=null},this)},e.prototype.CheckIsOneWaterFullOrEmpty=function(){return this.CheckOneWaterFull()?!0:0==this.waterUIScripts.length?!0:!1},e.prototype.AddWaterByBackOperate=function(t,e){var i=this.TopWater;if(null==i){var n=new WaterData(t);n.isHide=!1,n.num=e;var r=this.EnqueueWater(n,!1);return void r.RefreshUI()}if(i.waterData.colorInt==t)i.waterData.num+=e,i.RefreshUI();else{var n=new WaterData(t);n.isHide=!1,n.num=e;var r=this.EnqueueWater(n,!1);r.RefreshUI()}},e.prototype.RemoveWaterByBackOperate=function(t,e){var i=this.TopWater;if(i.waterData.colorInt==t)if(i.waterData.num>e)i.waterData.num-=e,i.RefreshUI();else{var n=this.DequeueWater();n.Destroy()}},e.prototype.Shake=function(){},e.prototype.Destroy=function(){if(this.removeListener(),this.onPullInComplete=null,this.pullInObj=null,null!=this.waterUIScripts){for(var t=this.waterUIScripts.length,e=t-1;e>=0;e--)null!=this.waterUIScripts[e]&&(this.waterUIScripts[e].Destroy(),delete this.waterUIScripts[e]);this.waterUIScripts=null}this.waterContainer.mask=null,delete this.waterContainer,delete this.waterMask,delete this.waterFlow,delete this.tubeFG,this.waterContainer=null,this.waterMask=null,this.waterFlow=null,this.tubeFG=null},e.prototype.addListener=function(){EventCenter.AddListener(EventID.ThemeBtnClicked,this.onThemeBtnClicked,this)},e.prototype.removeListener=function(){EventCenter.RemoveListener(EventID.ThemeBtnClicked,this.onThemeBtnClicked,this)},e.prototype.onThemeBtnClicked=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=PlayerData.Instance.curTubeID,r=DataConfig.Instance.GetDataByIndex("tube",n);if(null!=r)if(i){var s=RES.getRes(r.fgSprite);this.tubeFG.texture=s}else{var s=RES.getRes(r.fgSprite2);this.tubeFG.texture=s}},e.selectTweener=null,e}(egret.DisplayObjectContainer);__reflect(TubeScript.prototype,"TubeScript");var Vector2=function(){function t(t,e){this.x=t,this.y=e}return t}();__reflect(Vector2.prototype,"Vector2");var WaterData=function(){function t(t){this.orginId=t;var e=t;t>1e3&&(e=t-1e3);var i=DataConfig.Instance.GetDataByIndex("water",e);this.isHide=t>1e3,this.color=Utility.ColorHTMLToInt(i.ColorStr),this.colorInt=e,this.num=1}return t}();__reflect(WaterData.prototype,"WaterData");var AngleInfo=function(){function t(t,e){this.angle=t,this.height=e}return t}();__reflect(AngleInfo.prototype,"AngleInfo");var WaterScript=function(t){function e(){var e=t.call(this)||this;return e.angleInfos=[],e._waterWidth=80,e._waterHeight=66,e.tweener=null,e.InitUI(),e}return __extends(e,t),Object.defineProperty(e.prototype,"Deg2Rad",{get:function(){return Utility.Deg2Rad},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waterData",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tubeScript",{get:function(){return this.tube},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFlow",{get:function(){return this._isFlow},set:function(t){this._isFlow=t,this.water.alpha=t?0:1,this.waterFlow.alpha=t?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waterWidth",{get:function(){return this._waterWidth},set:function(t){this._waterWidth=t,this.width=t,this.water.width=t,this.waterFlow.width=t,this.hide.width=t,this.hideTxt.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waterHeight",{get:function(){return this._waterHeight},set:function(t){this._waterHeight=t,this.height=t,this.water.height=t,this.waterFlow.height=t,this.hide.height=t,this.hideTxt.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"RealHeight",{get:function(){return this.waterHeight*this.data.num},enumerable:!0,configurable:!0}),e.prototype.Init=function(t,e){this.tube=t,this.InitAngleInfos(),this.data=e,Utility.setImageColor(this.water,e.color),Utility.setGifColor(this.waterFlow,e.color),this.waterWidth=t.waterWidth,this.waterHeight=t.waterHeight,this.SetSize(this.waterWidth,this.RealHeight),this.isFlow=!1,t.waterContainer.addChild(this);var i=e.isHide?1:0;this.hide.alpha=i,this.hideTxt.alpha=i},e.prototype.InitUI=function(){this.width=this.waterWidth,this.height=this.waterHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.x=0,this.y=0;var t=Utility.createBitmapByName("white_jpg");t.width=this.width,t.height=this.height,t.x=0,t.y=0,this.addChild(t),this.water=t;var e=Utility.createGif("water_flow_json","water_flow_png");e.frameRate=12,e.width=this.width,e.height=this.height,e.x=0,e.y=0,e.gotoAndPlay(0,-1),this.addChild(e),this.waterFlow=e;var i=Utility.createBitmapByName("white_jpg");Utility.setImageColor(i,Utility.ColorHTMLToInt("#3F3F3F")),i.width=this.width,i.height=this.height,i.x=0,i.y=0,this.addChild(i),this.hide=i;var n=new egret.TextField;n.text="?",n.fontFamily="myFirstFont",n.textColor=16777215,n.textAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.width=this.width,n.height=this.height,n.x=0,n.y=0,n.size=30,this.hideTxt=n,this.addChild(n)},e.prototype.InitAngleInfos=function(){if(!(this.angleInfos.length>0))for(var t=this.tube.PullAngles,e=0;e<t.length;e++){var i=t.length-1-e,n=t[i],r=Math.cos(n*this.Deg2Rad),s=this.tube.MaxWaterNum-e,h=(this.tube.tubeWidth-this.tube.tubeMouthWidth)/2,a=h*Math.sin(n*this.Deg2Rad),o=this.tube.tubeHeight*r+a,l=0==s?0:Math.ceil(o/s);this.angleInfos.push(new AngleInfo(n,l))}},e.prototype.SetSize=function(t,e){this.scaleX=t/this._waterWidth,this.scaleY=e/this._waterHeight},Object.defineProperty(e.prototype,"sizeX",{set:function(t){this.scaleX=t/this._waterWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizeY",{set:function(t){this.scaleY=t/this._waterHeight},enumerable:!0,configurable:!0}),e.prototype.GetWidth=function(t){var e=Math.abs(t);return e>this.tube.tubeSlash&&(e=this.tube.tubeSlash),e},e.prototype.GetPos=function(){return new Vector2(this.x,this.y)},e.prototype.SetPos=function(t,e){this.x=t,this.y=e},e.prototype.CloseHideImg=function(){var t=this,e=egret.Tween.get(this.hide);this.removeChild(this.hideTxt),e.to({alpha:0},500).call(function(){t.removeChild(t.hide),t.hideTxt.alpha=0,delete t.hide,delete t.hideTxt,t.hide=null,t.hideTxt=null},this)},e.prototype.DoRotate=function(t){this.rotation=t},e.prototype.SetWaterAnchoredPosition=function(t){this.tube.pullDir==PullDir.Left?this.SetPos(this.width/2,t):this.SetPos(this.width/2,t)},e.prototype.SetPullWaterSize=function(t,e){var i=(this.tube.tubeWidth-this.tube.tubeMouthWidth)/2,n=i*Math.sin(t*this.Deg2Rad),r=this.tube.tubeHeight*Math.cos(t*this.Deg2Rad)+n,s=r>e?r-e:0,h=0==s?0:this.CalWidth(t,s);h=2*(this.y*Math.sin(t*Utility.Deg2Rad)+this.waterWidth/2*Math.sin(t*Utility.Deg2Rad)),this.SetSize(h,s)},e.prototype.RefreshWidthAndHeight=function(t){var e=this.CalHeight(t)*this.waterData.num,i=2*(this.y*Math.sin(t*Utility.Deg2Rad)+this.waterWidth/2*Math.sin(t*Utility.Deg2Rad));return this.SetSize(i,e),e},e.prototype.CalWidth=function(t,e){var i=0;if(t=Math.abs(t),.01>t)return 2*this.width;if(t>=89.99)return 2*this.tube.tubeHeight;for(var n=0;n<this.angleInfos.length;n++){var r=this.angleInfos[n];if(t<r.angle){var s=90==t?this.tube.tubeHeight:e*Math.tan(t*this.Deg2Rad),h=Math.cos(t*this.Deg2Rad),a=0==h?this.tube.tubeHeight:this.tube.tubeWidth/h,o=this.tube.tubeWidth*h;s=this.GetWidth(s),a=this.GetWidth(a),o=this.GetWidth(o),i=2*Math.max(Math.max(s,a),o);break}}return i},e.prototype.Lerp=function(t,e,i){return Utility.Lerp(t,e,i)},e.prototype.CalHeight=function(t){var e=0;if(t=Math.abs(t),.01>t)return this.height;if(t>=89.99)return 0;for(var i=0;i<this.angleInfos.length;i++){var n=this.angleInfos[i];if(t<n.angle){if(0==i){var r=t/n.angle,s=this.height,h=n.height;e=this.Lerp(s,h,r)}else{var a=this.angleInfos[i-1],r=(t-a.angle)/(n.angle-a.angle),s=a.height,h=n.height;e=this.Lerp(s,h,r)}break}}return e},e.prototype.SetFlow=function(){this.isFlow=!0},e.prototype.SetFull=function(){this.isFlow=!1},Object.defineProperty(e.prototype,"pullInTweener",{get:function(){return this.tweener},enumerable:!0,configurable:!0}),e.prototype.DealPullIn=function(t){var e=this;this.SetFlow();var i=(this.RealHeight,this.data.num);null==this.tweener?(this.tweener=egret.Tween.get(this),this.tweener.to({scaleX:i+1,scaleY:i},1e3*t).call(function(){e.SetFull(),e.scaleX=1,e.scaleY=i,e.OnPullInDone(),e.tweener=null},this)):(egret.Tween.removeTweens(this),this.tweener=null,this.tweener=egret.Tween.get(this),this.tweener.to({scaleX:i+1,scaleY:i},1e3*t).call(function(){e.SetFull(),e.scaleX=1,e.scaleY=i,e.OnPullInDone(),e.tweener=null},this))},e.prototype.OnPullInDone=function(){this.tube.DoPullInComplete(this.tube)},e.prototype.SetHideTextActive=function(t){t&&this.waterData.isHide?this.hideTxt.alpha=1:this.hideTxt.alpha=0},e.prototype.RefreshUI=function(){this.SetSize(this.waterWidth,this.RealHeight)},e.prototype.Destroy=function(){this.parent.removeChild(this),this.removeChild(this.water),this.removeChild(this.waterFlow),null!=this.hide&&(this.removeChild(this.hide),delete this.hide,this.hide=null),null!=this.hideTxt&&(this.removeChild(this.hideTxt),delete this.hideTxt,this.hideTxt=null),delete this.water,delete this.waterFlow,this.water=null,this.waterFlow=null},e}(egret.DisplayObjectContainer);__reflect(WaterScript.prototype,"WaterScript");var DrawScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.InitBG()},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("mask_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.Update=function(){},e.prototype.addListener=function(){},e.prototype.removeListener=function(){},e}(Scene);__reflect(DrawScene.prototype,"DrawScene");var GameOperate=function(){function t(t,e,i,n){this.src=t,this.tar=e,this.clr=i,this.num=n}return t}();__reflect(GameOperate.prototype,"GameOperate");var GameType;!function(t){t[t.Normal=0]="Normal",t[t.Difficult=1]="Difficult"}(GameType||(GameType={}));var GameScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tubes=[],e.curSelectTube=null,e.operateStack=[],e.gameType=GameType.Normal,e.levelId=1,e.isSetChild=!1,e}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.InitParams.apply(this,t),this.InitBG(),this.InitDiamons(),this.InitLevelTxt(),this.InitPauseBtn(),this.InitTubeContainer(),this.InitBottomBtn(),this.InitMask(),this.LoadLevel()},e.prototype.InitParams=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!=t[0]?0==t[0]?this.gameType=GameType.Normal:1==t[0]&&(this.gameType=GameType.Difficult):this.gameType=GameType.Normal,null!=t[1]?this.levelId=t[1]:this.levelId=PlayerData.Instance.GetCurLevel(this.gameType)},e.prototype.InitBG=function(){var t=PlayerData.Instance.curThemeID,e=DataConfig.Instance.GetDataByIndex("theme",t),i=null==e?"bg_1_png":e.bgSprite;if(null==this.bg)this.bg=this.createBitmapByName(i),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg);else{var n=RES.getRes(i);this.bg.texture=n}},e.prototype.InitDiamons=function(){var t="icon1_png";this.gameType==GameType.Normal?t="icon1_png":this.gameType==GameType.Difficult&&(t="icon10_png");var e=PlayerData.Instance.GetDiamons(this.gameType);null==this.diamonLayout?(this.diamonLayout=GameUtil.createDiamonLayout(t,e),this.diamonLayout.x=30,this.diamonLayout.y=30,this.addChild(this.diamonLayout)):GameUtil.changeDiamonIconAndNum(this.diamonLayout,t,e)},e.prototype.InitLevelTxt=function(){var t="LEVEL "+String(this.levelId);null==this.levelTxt?(this.levelTxt=this.createTextField(300,60,16777215,30,t),this.levelTxt.textAlign=egret.HorizontalAlign.CENTER,this.levelTxt.x=SceneManager.ScreenWidth/2-this.levelTxt.width/2,this.levelTxt.y=30,this.addChild(this.levelTxt)):this.levelTxt.text=t},e.prototype.InitPauseBtn=function(){var t=PlayerData.Instance.curThemeID,e=DataConfig.Instance.GetDataByIndex("theme",t),i="sun_png";if(this.isSun=!0,null!=e&&1==e.tubeFgIndex&&(i="moon_png",this.isSun=!1),null==this.pauseBtn){var n=70;this.pauseBtn=this.createBitmapByName("btn3_png"),this.pauseBtn.fillMode=egret.BitmapFillMode.SCALE,this.pauseBtn.width=60,this.pauseBtn.height=60,this.pauseBtn.x=SceneManager.ScreenWidth-this.pauseBtn.width-30,this.pauseBtn.y=n,this.addChild(this.pauseBtn),this.themeBtn=this.createBitmapByName(i),this.themeBtn.fillMode=egret.BitmapFillMode.SCALE,this.themeBtn.width=64,this.themeBtn.height=90,this.themeBtn.x=SceneManager.ScreenWidth-this.themeBtn.width,this.themeBtn.y=this.pauseBtn.y+this.pauseBtn.height,this.addChild(this.themeBtn)}else this.themeBtn.texture=RES.getRes(i)},e.prototype.InitBottomBtn=function(){if(null!=this.restartBtn)return this.backTxt.text=String(PlayerData.Instance.backNum),this.addTxt.text=String(PlayerData.Instance.newTubeNum),void(this.gameType==GameType.Normal?null==this.getChildByName("addBtn")&&this.addChild(this.addBtn):null!=this.getChildByName("addBtn")&&this.removeChild(this.addBtn));for(var t=SceneManager.ScreenWidth/4,e=120,i=80,n=0;3>n;n++){var r=2>n?"btn1_png":"btn2_png",s=this.createButton(r,e,i);if(s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=t*(n+1),s.y=SceneManager.ScreenHeight-240,this.addChild(s),0==n){var h=this.createBitmapByName("tag1_png");h.fillMode=egret.BitmapFillMode.SCALE,h.width=50.4,h.height=48,h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,h.x=e/2,h.y=i/2,s.addChild(h),this.restartBtn=s}else if(1==n){var a=this.createBitmapByName("tag2_png");a.fillMode=egret.BitmapFillMode.SCALE,a.width=50.4,a.height=48,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=e/2-20,a.y=i/2,s.addChild(a);var o=String(PlayerData.Instance.backNum),l=this.createTextField(e/2-10,i,3935244,30,o);l.x=e/2+10,s.addChild(l),this.backBtn=s,this.backTxt=l}else{var c=this.createBitmapByName("tag3_png");c.fillMode=egret.BitmapFillMode.SCALE,c.width=50.4,c.height=48,c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height/2,c.x=e/2-20,c.y=i/2,s.addChild(c),s.name="addBtn";var u=String(PlayerData.Instance.newTubeNum),d=this.createTextField(e/2-10,i,16777215,30,u);d.x=e/2+10,s.addChild(d),this.addBtn=s,this.addTxt=d}}this.gameType==GameType.Normal?null==this.getChildByName("addBtn")&&this.addChild(this.addBtn):null!=this.getChildByName("addBtn")&&this.removeChild(this.addBtn)},e.prototype.InitTubeContainer=function(){if(null==this.tubeContainer){var t=220,e=280,i=new egret.DisplayObjectContainer;i.width=SceneManager.ScreenWidth,i.height=SceneManager.ScreenHeight-t-e,i.x=0,i.y=t,this.tubeContainer=i,this.addChild(i)}},e.prototype.InitMask=function(){var t=this.createBitmapByName("white_jpg");Utility.setImageColor(t,0),t.alpha=.4,t.width=SceneManager.ScreenWidth,t.height=SceneManager.ScreenHeight,t.touchEnabled=!0,this.maskGo=t,this.isSetChild=!1},e.prototype.SetMask=function(t){if(t){if(this.isSetChild)return;this.addChild(this.maskGo),this.isSetChild=!0}else{if(!this.isSetChild)return;this.removeChild(this.maskGo),this.isSetChild=!1}},e.prototype.LoadLevel=function(){if(this.SetMask(!1),this.operateStack.length>0){for(var t=this.operateStack.length,e=t-1;e>=0;e--)delete this.operateStack[e];this.operateStack=[]}this.curSelectTube=null,this.hasAddNewTube=!1;for(var i=this.levelId,n=(this.gameType,DataConfig.Instance.GetDataByIndex("level",i));null==n;)i-=1,n=DataConfig.Instance.GetDataByIndex("level",i);this.ClearTubes();var r=GameUtil.ParseLevelCfg(n.Config);this.InitTubes(r),this.SetTubesPostion();var s="LEVEL "+String(this.levelId);this.levelTxt.text=s},e.prototype.ClearTubes=function(){this.tubeContainer.removeChildren();for(var t=this.tubes.length,e=t-1;e>=0;e--)this.tubes[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.tubes[e].tubeClickFunc,this),this.tubes[e].Destroy(),delete this.tubes[e];this.tubes=[]},e.prototype.InitTube=function(t,e){var i=new TubeScript;i.name=String(e),i.Init(t);var n=this.OnTubeClick.bind(this,e);i.addEventListener(egret.TouchEvent.TOUCH_TAP,n,this),i.tubeClickFunc=n,i.SetPullInComplete(this.OnTubePullInComplete,this),this.tubeContainer.addChild(i),this.tubes.push(i)},e.prototype.InitTubes=function(t){for(var e=t.length,i=0;e>i;i++){var n=t[i];this.InitTube(n,i)}},e.prototype.SetTubesPostion=function(){var t=this.tubes.length;if(5>t)for(var e=this.tubeContainer.width/t,i=this.tubeContainer.height,n=0;t>n;n++){var r=this.tubes[n],s=e*n+e/2-r.tubeWidth/2,h=i/2-r.tubeHeight/2;r.SetPosition(s,h),r.y=h}else for(var a=Math.ceil(t/2),o=t-a,n=0;t>n;n++){var r=this.tubes[n];if(a>n){var e=this.tubeContainer.width/a,i=this.tubeContainer.height/2,s=e*n+e/2-r.tubeWidth/2,h=i/2-r.tubeHeight/2;r.SetPosition(s,h)}else{var e=this.tubeContainer.width/o,i=this.tubeContainer.height/2,s=e*(n-a)+e/2-r.tubeWidth/2,h=this.tubeContainer.height/2+i/2-r.tubeHeight/2;r.SetPosition(s,h)}}},e.prototype.OnTubePullInComplete=function(t){t.CheckOneWaterFull()&&(t.PlayOneWaterFullEffect(),AudioManager.Instance.PlaySound("complete_mp3")),this.CheckLevelComplete()&&this.LevelComplete()},e.prototype.CheckLevelComplete=function(){for(var t=0;t<this.tubes.length;t++){var e=this.tubes[t];if(0==e.CheckIsOneWaterFullOrEmpty())return!1}return!0},e.prototype.LevelComplete=function(){var t=this;this.SetMask(!0),this.intervalInt=egret.setInterval(function(){SceneManager.Instance.pushScene("ResultScene",t.gameType,t.levelId),egret.clearInterval(t.intervalInt)},this,1e3)},e.prototype.OnTubeClick=function(t){console.log("index",t);var e=this.tubes[t];null==this.curSelectTube?e.canSelect()&&e.Select()&&(this.curSelectTube=e):this.curSelectTube==e?this.curSelectTube.UnSelect()&&(this.curSelectTube=null):this.curSelectTube.canPull(e)?(this.RecordPullOperate(this.curSelectTube,e),this.curSelectTube.Pull(e),this.curSelectTube=null):this.curSelectTube.UnSelect()&&(this.curSelectTube=null)},e.prototype.RecordPullOperate=function(t,e){var i=t.TopWaterData,n=t.canPullNum(e),r=Number(t.name),s=Number(e.name),h=new GameOperate(r,s,i.colorInt,n);
this.operateStack.push(h)},e.prototype.Update=function(){},e.prototype.addListener=function(){this.diamonLayout.touchEnabled=!0,this.diamonLayout.addEventListener(egret.TouchEvent.TOUCH_TAP,this.diamonClick,this),Utility.ButtonActive2(this.pauseBtn,!0),this.pauseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pauseClick,this),this.themeBtn.touchEnabled=!0,this.themeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.themeClick,this),Utility.ButtonActive(this.restartBtn,!0),this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartClick,this),Utility.ButtonActive(this.backBtn,!0),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backClick,this),Utility.ButtonActive(this.addBtn,!0),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addTubeClick,this),EventCenter.AddListener(EventID.RefreshLevel,this.OnRefreshLevel,this)},e.prototype.removeListener=function(){this.diamonLayout.touchEnabled=!1,this.diamonLayout.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.diamonClick,this),Utility.ButtonActive2(this.pauseBtn,!1),this.pauseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.pauseClick,this),this.themeBtn.touchEnabled=!1,this.themeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.themeClick,this),Utility.ButtonActive(this.restartBtn,!1),this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restartClick,this),Utility.ButtonActive(this.backBtn,!1),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.backClick,this),Utility.ButtonActive(this.addBtn,!1),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.addTubeClick,this),EventCenter.RemoveListener(EventID.RefreshLevel,this.OnRefreshLevel,this)},e.prototype.diamonClick=function(){SceneManager.Instance.pushScene("ShopScene")},e.prototype.pauseClick=function(){SceneManager.Instance.pushScene("PauseScene")},e.prototype.themeClick=function(){this.isSun?(this.themeBtn.texture=RES.getRes("moon_png"),this.isSun=!1):(this.themeBtn.texture=RES.getRes("sun_png"),this.isSun=!0),EventCenter.Notify(EventID.ThemeBtnClicked,this.isSun)},e.prototype.restartClick=function(){this.LoadLevel()},e.prototype.backClick=function(){var t=PlayerData.Instance.backNum;if(0>=t)return void Utility.showNotiBox("看广告给5个回退道具");if(0!=this.operateStack.length){t-=1,PlayerData.Instance.backNum=t,this.backTxt.text=String(t);var e=this.operateStack.pop(),i=e.src,n=e.tar;this.tubes[i].AddWaterByBackOperate(e.clr,e.num),this.tubes[n].RemoveWaterByBackOperate(e.clr,e.num)}},e.prototype.addTubeClick=function(){var t=PlayerData.Instance.newTubeNum;if(0>=t)return void Utility.showNotiBox("看广告给1个试管道具");if(!this.hasAddNewTube){this.hasAddNewTube=!0,t-=1,PlayerData.Instance.newTubeNum=t,this.addTxt.text=String(t);var e=(new TubeScript,[]),i=this.tubes.length;this.InitTube(e,i),this.SetTubesPostion()}},e.prototype.OnRefreshLevel=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gameType=t[0],this.levelId=t[1],this.InitDiamons(),this.LoadLevel()},e}(Scene);__reflect(GameScene.prototype,"GameScene");var PauseScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.InitBG(),this.InitPanel(),this.InitHelpBtn(),this.PlayTween()},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("mask_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.InitPanel=function(){var t=PlayerData.Instance.bgmOn,e=PlayerData.Instance.soundOn;if(null==this.panel){this.panel=new egret.DisplayObjectContainer,this.panel.width=SceneManager.ScreenWidth-80,this.panel.height=260,this.panel.anchorOffsetX=this.panel.width/2,this.panel.anchorOffsetY=this.panel.height/2,this.panel.x=SceneManager.ScreenWidth/2,this.panel.y=SceneManager.ScreenHeight/2,this.addChild(this.panel);var i=this.createBitmapByName("di2_png");i.fillMode=egret.BitmapFillMode.SCALE,i.width=this.panel.width,i.height=this.panel.height,this.panel.addChild(i);var n=this.panel.width/4,r=this.panel.width/6,s=n/2-r/2,h=this.panel.height/4-r/2+10;this.bgmOnBtn=this.createButton("bgm_on_png",r,r),this.bgmOnBtn.name="bgmOnBtn",this.bgmOnBtn.x=s,this.bgmOnBtn.y=h,this.bgmOffBtn=this.createButton("bgm_off_png",r,r),this.bgmOffBtn.name="bgmOffBtn",this.bgmOffBtn.x=s,this.bgmOffBtn.y=h,this.soundOnBtn=this.createButton("sound_on_png",r,r),this.soundOnBtn.name="soundOnBtn",this.soundOnBtn.x=s+n,this.soundOnBtn.y=h,this.soundOffBtn=this.createButton("sound_off_png",r,r),this.soundOffBtn.name="soundOffBtn",this.soundOffBtn.x=s+n,this.soundOffBtn.y=h,this.menuBtn=this.createButton("menu2_png",r,r),this.menuBtn.x=s+2*n,this.menuBtn.y=h,this.panel.addChild(this.menuBtn),this.homeBtn=this.createButton("home_png",r,r),this.homeBtn.x=s+3*n,this.homeBtn.y=h,this.panel.addChild(this.homeBtn),t?this.panel.addChild(this.bgmOnBtn):this.panel.addChild(this.bgmOffBtn),e?this.panel.addChild(this.soundOnBtn):this.panel.addChild(this.soundOffBtn),s=20,h=20,n=this.panel.width/2,r=n-2*s;var a=this.panel.height/2-2*h;this.skinBtn=this.createButton("zt_anniu_png",r,a),this.skinBtn.x=s,this.skinBtn.y=this.panel.height/2+h;var o=78*.7,l=this.createBitmapByName("pause_icon2_png");l.fillMode=egret.BitmapFillMode.SCALE,l.width=o,l.height=o,l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.x=this.skinBtn.width/2,l.y=this.skinBtn.height/2,this.skinBtn.addChild(l),this.panel.addChild(this.skinBtn),this.resumeBtn=this.createButton("zt_anniu_png",r,a),this.resumeBtn.x=s+n,this.resumeBtn.y=this.panel.height/2+h;var c=this.createBitmapByName("pause_icon1_png");c.fillMode=egret.BitmapFillMode.SCALE,c.width=o,c.height=o,c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height/2,c.x=this.resumeBtn.width/2,c.y=this.resumeBtn.height/2,this.resumeBtn.addChild(c),this.panel.addChild(this.resumeBtn)}else t?(null!=this.getChildByName("bgmOffBtn")&&this.panel.removeChild(this.bgmOffBtn),null==this.getChildByName("bgmOnBtn")&&this.panel.addChild(this.bgmOnBtn)):(null!=this.getChildByName("bgmOnBtn")&&this.panel.removeChild(this.bgmOnBtn),null==this.getChildByName("bgmOffBtn")&&this.panel.addChild(this.bgmOffBtn)),e?(null!=this.getChildByName("soundOffBtn")&&this.panel.removeChild(this.soundOffBtn),null==this.getChildByName("soundOnBtn")&&this.panel.addChild(this.soundOnBtn)):(null!=this.getChildByName("soundOnBtn")&&this.panel.removeChild(this.soundOnBtn),null==this.getChildByName("soundOffBtn")&&this.panel.addChild(this.soundOffBtn))},e.prototype.InitHelpBtn=function(){if(null==this.helpBtn){var t=300,e=134;this.helpBtn=this.createButton("help_png",t,e),this.helpBtn.x=SceneManager.ScreenWidth/2,this.helpBtn.y=SceneManager.ScreenHeight/2-this.panel.height/2-e;var i=this.createTextField(t,1.3*e,16777215,30,"关卡打不过了？邀请好友帮你通关吧");i.x=0,i.y=-i.height,this.helpBtn.addChild(i),this.addChild(this.helpBtn)}},e.prototype.PlayTween=function(){var t=SceneManager.ScreenWidth/2,e=-this.panel.width/2-40;this.panel.x=e,this.helpBtn.x=e;var i=egret.Tween.get(this.panel),n=egret.Tween.get(this.helpBtn);i.wait(400).to({x:t},500,egret.Ease.backOut),n.wait(500).to({x:t},500,egret.Ease.backOut)},e.prototype.Update=function(){},e.prototype.addListener=function(){this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bgClick,this),Utility.ButtonActive(this.helpBtn,!0),this.helpBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.helpBtnClick,this),Utility.ButtonActive(this.bgmOnBtn,!0),this.bgmOnBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bgmOnBtnClick,this),Utility.ButtonActive(this.bgmOffBtn,!0),this.bgmOffBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bgmOffBtnClick,this),Utility.ButtonActive(this.soundOnBtn,!0),this.soundOnBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.soundOnBtnClick,this),Utility.ButtonActive(this.soundOffBtn,!0),this.soundOffBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.soundOffBtnClick,this),Utility.ButtonActive(this.menuBtn,!0),this.menuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.menuBtnClick,this),Utility.ButtonActive(this.homeBtn,!0),this.homeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.homeBtnClick,this),Utility.ButtonActive(this.skinBtn,!0),this.skinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skinBtnClick,this),Utility.ButtonActive(this.resumeBtn,!0),this.resumeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resumeBtnClick,this)},e.prototype.removeListener=function(){this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bgClick,this),Utility.ButtonActive(this.helpBtn,!1),this.helpBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.helpBtnClick,this),Utility.ButtonActive(this.bgmOnBtn,!1),this.bgmOnBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bgmOnBtnClick,this),Utility.ButtonActive(this.bgmOffBtn,!1),this.bgmOffBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bgmOffBtnClick,this),Utility.ButtonActive(this.soundOnBtn,!1),this.soundOnBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.soundOnBtnClick,this),Utility.ButtonActive(this.soundOffBtn,!1),this.soundOffBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.soundOffBtnClick,this),Utility.ButtonActive(this.menuBtn,!1),this.menuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.menuBtnClick,this),Utility.ButtonActive(this.homeBtn,!1),this.homeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.homeBtnClick,this),Utility.ButtonActive(this.skinBtn,!1),this.skinBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.skinBtnClick,this),Utility.ButtonActive(this.resumeBtn,!1),this.resumeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.resumeBtnClick,this)},e.prototype.bgClick=function(){SceneManager.Instance.popScene()},e.prototype.helpBtnClick=function(){},e.prototype.bgmOnBtnClick=function(){var t=!1;PlayerData.Instance.bgmOn=t,AudioManager.Instance.BMGVolume=0,t?(null!=this.getChildByName("bgmOffBtn")&&this.panel.removeChild(this.bgmOffBtn),null==this.getChildByName("bgmOnBtn")&&this.panel.addChild(this.bgmOnBtn)):(null!=this.getChildByName("bgmOnBtn")&&this.panel.removeChild(this.bgmOnBtn),null==this.getChildByName("bgmOffBtn")&&this.panel.addChild(this.bgmOffBtn))},e.prototype.bgmOffBtnClick=function(){var t=!0;PlayerData.Instance.bgmOn=t,AudioManager.Instance.BMGVolume=1,t?(null!=this.getChildByName("bgmOffBtn")&&this.panel.removeChild(this.bgmOffBtn),null==this.getChildByName("bgmOnBtn")&&this.panel.addChild(this.bgmOnBtn)):(null!=this.getChildByName("bgmOnBtn")&&this.panel.removeChild(this.bgmOnBtn),null==this.getChildByName("bgmOffBtn")&&this.panel.addChild(this.bgmOffBtn))},e.prototype.soundOnBtnClick=function(){var t=!1;PlayerData.Instance.soundOn=t,t?(null!=this.getChildByName("soundOffBtn")&&this.panel.removeChild(this.soundOffBtn),null==this.getChildByName("soundOnBtn")&&this.panel.addChild(this.soundOnBtn)):(null!=this.getChildByName("soundOnBtn")&&this.panel.removeChild(this.soundOnBtn),null==this.getChildByName("soundOffBtn")&&this.panel.addChild(this.soundOffBtn))},e.prototype.soundOffBtnClick=function(){var t=!0;PlayerData.Instance.soundOn=t,t?(null!=this.getChildByName("soundOffBtn")&&this.panel.removeChild(this.soundOffBtn),null==this.getChildByName("soundOnBtn")&&this.panel.addChild(this.soundOnBtn)):(null!=this.getChildByName("soundOnBtn")&&this.panel.removeChild(this.soundOnBtn),null==this.getChildByName("soundOffBtn")&&this.panel.addChild(this.soundOffBtn))},e.prototype.menuBtnClick=function(){SceneManager.Instance.pushScene("SelectLevelScene")},e.prototype.homeBtnClick=function(){SceneManager.Instance.popScene(),SceneManager.Instance.changeScene("StartScene")},e.prototype.skinBtnClick=function(){SceneManager.Instance.pushScene("ShopScene")},e.prototype.resumeBtnClick=function(){SceneManager.Instance.popScene()},e}(Scene);__reflect(PauseScene.prototype,"PauseScene");var RankScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.InitBG()},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("mask_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.Update=function(){},e.prototype.addListener=function(){},e.prototype.removeListener=function(){},e}(Scene);__reflect(RankScene.prototype,"RankScene");var ResultScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isNewComplete=!1,e.angles=[6,15.2,24],e.curAngle=0,e.speedV=3.3,e.dir=1,e.minSpeed=18,e.isClickAds=!1,e.isPlayAnim=!1,e}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gameType=t[0],this.completeLevel=t[1],this.Cal(),this.InitBG(),this.InitProcess(),this.InitLevelTxt(),this.InitNextBtn(),this.InitZhuanPan(),this.PlayTween()},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("bg_1_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.Cal=function(){var t=PlayerData.Instance.GetCurLevel(this.gameType),e=this.completeLevel;e>=t?(this.isNewComplete=!0,this.oldProcess=PlayerData.Instance.process,this.newProcess=this.oldProcess+10,PlayerData.Instance.process=this.newProcess,PlayerData.Instance.CurLevelAdd(this.gameType)):(this.isNewComplete=!1,this.oldProcess=PlayerData.Instance.process,this.newProcess=this.oldProcess)},e.prototype.InitProcess=function(){if(null==this.processContainer){var t=SceneManager.ScreenWidth/2,e=36;this.processContainer=this.createButton("process2_png",t,e),this.processContainer.anchorOffsetX=this.processContainer.width/2,this.processContainer.anchorOffsetY=this.processContainer.height/2,this.processContainer.x=SceneManager.ScreenWidth/2,this.processContainer.y=240,this.addChild(this.processContainer),this.processTr=this.createBitmapByName("process1_png"),this.processTr.fillMode=egret.BitmapFillMode.SCALE,this.processTr.width=72,this.processTr.height=36,this.processContainer.addChild(this.processTr);var i=this.createBitmapByName("chest_png");i.fillMode=egret.BitmapFillMode.SCALE,i.width=100,i.height=100,i.x=t-i.width/2,i.y=-i.height/2+10,this.processContainer.addChild(i),this.processTxt=this.createTextField(t,e,16777215,24,this.oldProcess+"%"),this.processTxt.textAlign=egret.HorizontalAlign.CENTER,this.processContainer.addChild(this.processTxt)}this.ProcessChanged(this.oldProcess)},e.prototype.ProcessChanged=function(t){t=Math.ceil(t),t=Math.min(100,t),this.processTxt.text=t+"%",this.processTr.width=Math.max(60,this.processContainer.width/100*t)},e.prototype.DoProcess=function(){this.isNewComplete&&Utility.Float(this.oldProcess,this.newProcess,500,this.ProcessChanged,this)},e.prototype.InitLevelTxt=function(){if(null==this.levelTxt){var t=SceneManager.ScreenWidth/2,e=80;this.levelTxt=this.createTextField(t,e,16777215,46),this.levelTxt.textAlign=egret.HorizontalAlign.CENTER,this.levelTxt.anchorOffsetX=t/2,this.levelTxt.anchorOffsetY=e/2,this.levelTxt.x=SceneManager.ScreenWidth/2,this.levelTxt.y=360,this.addChild(this.levelTxt)}this.levelTxt.text="关卡"+this.completeLevel+"完成!"},e.prototype.InitNextBtn=function(){if(null==this.nextBtn){var t=200,e=100;this.nextBtn=this.createButton("empty_png",t,e,!0),this.nextBtn.x=SceneManager.ScreenWidth/2,this.nextBtn.y=SceneManager.ScreenHeight-240;var i=this.createTextField(t,e,16777215,32,"点击继续");i.textAlign=egret.HorizontalAlign.CENTER,i.y=-5,this.nextBtn.addChild(i),this.addChild(this.nextBtn)}},e.prototype.InitZhuanPan=function(){if(null==this.zhuanpanContainer){var t=this.levelTxt.y+this.levelTxt.height/2,e=240+this.nextBtn.height/2;this.zhuanpanContainer=new egret.DisplayObjectContainer,this.zhuanpanContainer.name="zhuanpanContainer",this.zhuanpanContainer.width=SceneManager.ScreenWidth,this.zhuanpanContainer.height=SceneManager.ScreenHeight-t-e,this.zhuanpanContainer.anchorOffsetX=SceneManager.ScreenWidth/2,this.zhuanpanContainer.anchorOffsetY=this.zhuanpanContainer.height/2,this.zhuanpanContainer.x=SceneManager.ScreenWidth/2,this.zhuanpanContainer.y=t+this.zhuanpanContainer.height/2;var i=this.createBitmapByName("zhuanpan_png");i.width=558,i.height=162,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=SceneManager.ScreenWidth/2,i.y=140,this.zhuanpanContainer.addChild(i),this.zhizhen=this.createBitmapByName("zhizhen_png"),this.zhizhen.width=55.2,this.zhizhen.height=80,this.zhizhen.anchorOffsetX=this.zhizhen.width/2,this.zhizhen.anchorOffsetY=600,this.zhizhen.x=SceneManager.ScreenWidth/2,this.zhizhen.y=740,this.zhuanpanContainer.addChild(this.zhizhen),this.adsBtn=this.createButton("btn2_png",400,130,!0),this.adsBtn.x=SceneManager.ScreenWidth/2,this.adsBtn.y=this.zhuanpanContainer.height-100,this.zhuanpanContainer.addChild(this.adsBtn);var n=75,r=5;this.adsTxt=this.createTextField(this.adsBtn.width,this.adsBtn.height,16777215,50,"200"),this.adsTxt.textAlign=egret.HorizontalAlign.CENTER,this.adsTxt.anchorOffsetX=this.adsTxt.width/2,this.adsTxt.anchorOffsetY=this.adsTxt.height/2,this.adsTxt.x=this.adsTxt.width/2,this.adsTxt.y=this.adsTxt.height/2-r,this.adsBtn.addChild(this.adsTxt);var s=this.createBitmapByName("js_ad_png",60,66,!0);s.x=n,s.y=this.adsBtn.height/2-r,this.adsBtn.addChild(s);var h=this.createBitmapByName("icon1_png",90,90,!0);h.x=this.adsBtn.width-n,h.y=this.adsBtn.height/2-r,this.adsBtn.addChild(h)}this.isNewComplete?null==this.getChildByName("zhuanpanContainer")&&this.addChild(this.zhuanpanContainer):null!=this.getChildByName("zhuanpanContainer")&&this.removeChild(this.zhuanpanContainer)},e.prototype.DoZhuanPanRotate=function(){if(!this.isClickAds&&this.isNewComplete){var t=Math.abs(this.angles[2]*this.dir-this.curAngle)*this.speedV;t<this.minSpeed*this.speedV&&(t=this.minSpeed*this.speedV),this.curAngle+=this.dir*t*.02,this.zhizhen.rotation=this.curAngle;var e=Math.abs(this.curAngle);e<=this.angles[0]?this.SetMultiple(5):e<=this.angles[1]?this.SetMultiple(3):e<=this.angles[2]?this.SetMultiple(2):this.dir*=-1}},e.prototype.SetMultiple=function(t){this.diamonNum=40*t,this.adsTxt.text=""+this.diamonNum},e.prototype.SetScale=function(t,e,i){return t.scaleX=0,t.scaleY=0,egret.Tween.get(t).wait(e).to({scaleX:1,scaleY:1},i,egret.Ease.backOut)},e.prototype.PlayTween=function(){var t=this;this.PlayLihua(),this.isClickAds=!1,this.isPlayAnim=!0;var e=0,i=200,n=400;this.SetScale(this.processContainer,e+=i,n),this.SetScale(this.levelTxt,e+=i,n).call(function(){t.DoProcess()},this),this.isNewComplete&&this.SetScale(this.zhuanpanContainer,e+=i,n),this.SetScale(this.nextBtn,e+=i,n).call(function(){t.isPlayAnim=!1},this)},e.prototype.PlayLihua=function(){null==this.lihua1&&(this.lihua1=this.createGif("lihua2_json","lihua2_png"),this.lihua1.x=0,this.lihua1.y=0,this.lihua1.frameRate=24,this.addChild(this.lihua1)),this.lihua1.gotoAndPlay(0,1),null==this.lihua2&&(this.lihua2=this.createGif("lihua2_json","lihua2_png"),this.lihua2.x=SceneManager.ScreenWidth,this.lihua2.y=0,this.lihua2.scaleX=-1,this.lihua2.frameRate=24,this.addChild(this.lihua2)),this.lihua2.gotoAndPlay(0,1),AudioManager.Instance.PlaySound("lihua2_mp3",1600)},e.prototype.Update=function(){this.DoZhuanPanRotate()},e.prototype.addListener=function(){this.bg.touchEnabled=!0,this.bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bgClick,this),Utility.ButtonActive(this.nextBtn,!0),Utility.ButtonActive(this.adsBtn,!0),this.adsBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.adsBtnClick,this),Utility.ButtonActive(this.nextBtn,!0),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.nextBtnClick,this)},e.prototype.removeListener=function(){this.bg.touchEnabled=!1,this.bg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bgClick,this),Utility.ButtonActive(this.adsBtn,!1),this.adsBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.adsBtnClick,this),Utility.ButtonActive(this.nextBtn,!1),this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.nextBtnClick,this)},e.prototype.bgClick=function(){},e.prototype.adsBtnClick=function(){this.isPlayAnim||(this.isClickAds=!0)},e.prototype.nextBtnClick=function(){if(!this.isPlayAnim)if(this.newProcess>=100);else{SceneManager.Instance.popScene();var t=PlayerData.Instance.GetCurLevel(this.gameType);EventCenter.Notify(EventID.RefreshLevel,this.gameType,t)}},e}(Scene);__reflect(ResultScene.prototype,"ResultScene");var SelectLevelScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levels=[],e.spacing=20,e.lineCount=5,e}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length>0?this.gameType=t[0]:this.gameType=GameType.Normal,this.InitBG(),this.InitTitleTXT(),this.InitCloseBtn(),this.InitLevelScrollView(),this.InitLevelDatas(),this.InitBottom(),this.RefreshLevelDatas()},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("bg_1_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.InitTitleTXT=function(){if(null==this.titleTXT){var t="选择关卡";this.titleTXT=this.createTextField(300,60,16777215,42,t),this.titleTXT.textAlign=egret.HorizontalAlign.CENTER,this.titleTXT.x=SceneManager.ScreenWidth/2-this.titleTXT.width/2,this.titleTXT.y=30,this.addChild(this.titleTXT)}},e.prototype.InitCloseBtn=function(){if(null==this.closeBtn){var t=70;this.closeBtn=this.createBitmapByName("close2_png"),this.closeBtn.fillMode=egret.BitmapFillMode.SCALE,this.closeBtn.width=60,this.closeBtn.height=60,this.closeBtn.x=SceneManager.ScreenWidth-this.closeBtn.width-30,this.closeBtn.y=t,this.addChild(this.closeBtn)}},e.prototype.InitLevelScrollView=function(){if(null==this.scrollView){var t=140,e=270,i=SceneManager.ScreenWidth-120,n=SceneManager.ScreenHeight-t-e,r=60,s=t;this.scrollView=new LzyScrollView(!0,i,n,r,s,0,0,"empty_png"),this.scrollView.name="levelSV",this.addChild(this.scrollView)}if(null==this.levelGrid){var i=(this.scrollView.width+this.spacing)/this.lineCount-this.spacing;this.levelGrid=new LevelGrid(this,i,i)}},e.prototype.InitLevelDatas=function(){var t=PlayerData.Instance.GetCurLevel(this.gameType);this.levelMax=t;var e=Math.ceil(t/100);1>e&&(e=1),this.pageMax=e,this.pageIndex=1},e.prototype.RefreshLevelDatas=function(){var t=1+100*(this.pageIndex-1),e=t+100;this.levels=[];for(var i=t;e>i;i++)i<=this.levelMax&&this.levels.push(i);this.RefreshScrollView(),this.pageTxt.text=String(this.pageIndex),1==this.pageIndex?null!=this.getChildByName("leftBtn")&&this.removeChild(this.bottomLeftBtn):null==this.getChildByName("leftBtn")&&this.addChild(this.bottomLeftBtn),this.pageIndex==this.pageMax?null!=this.getChildByName("rightBtn")&&this.removeChild(this.bottomRightBtn):null==this.getChildByName("rightBtn")&&this.addChild(this.bottomRightBtn)},e.prototype.RefreshScrollView=function(){this.scrollView.SetContent(this.spacing,this.spacing,this.levels,this.levelGrid)},e.prototype.addBtnEventListener=function(t){Utility.ButtonActive(t,!0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLevelBtnClick.bind(this,t),this)},e.prototype.onLevelBtnClick=function(t){var e=t.getChildByName("levelTxt");console.log(e.text);var i=Number(e.text);console.log(SceneManager.Instance.GetCurScene().name),"StartScene"==SceneManager.Instance.GetCurScene().name?(SceneManager.Instance.popScene(),SceneManager.Instance.changeScene("GameScene",this.gameType,i)):(SceneManager.Instance.popScene(),EventCenter.Notify(EventID.RefreshLevel,this.gameType,i))},e.prototype.InitBottom=function(){null==this.bottomLeftBtn&&(this.bottomLeftBtn=this.createBitmapByName("left_png",50,50,!0),this.bottomLeftBtn.name="leftBtn",this.bottomLeftBtn.fillMode=egret.BitmapFillMode.SCALE,this.bottomLeftBtn.x=SceneManager.ScreenWidth/2-100,this.bottomLeftBtn.y=SceneManager.ScreenHeight-220,this.addChild(this.bottomLeftBtn)),null==this.bottomRightBtn&&(this.bottomRightBtn=this.createBitmapByName("right_png",50,50,!0),this.bottomRightBtn.name="rightBtn",this.bottomRightBtn.fillMode=egret.BitmapFillMode.SCALE,this.bottomRightBtn.x=SceneManager.ScreenWidth/2+100,this.bottomRightBtn.y=SceneManager.ScreenHeight-220,this.addChild(this.bottomRightBtn));var t=String(this.pageIndex);null==this.pageTxt?(this.pageTxt=this.createTextField(300,100,16777215,30,t),this.pageTxt.textAlign=egret.HorizontalAlign.CENTER,this.pageTxt.anchorOffsetX=this.pageTxt.width/2,this.pageTxt.anchorOffsetY=this.pageTxt.height/2,this.pageTxt.x=SceneManager.ScreenWidth/2,this.pageTxt.y=SceneManager.ScreenHeight-220,this.addChild(this.pageTxt)):this.pageTxt.text=t},e.prototype.Update=function(){},e.prototype.addListener=function(){Utility.ButtonActive2(this.closeBtn,!0),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnClick,this),Utility.ButtonActive2(this.bottomLeftBtn,!0),this.bottomLeftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bottomLeftBtnClick,this),Utility.ButtonActive2(this.bottomRightBtn,!0),this.bottomRightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.bottomRightBtnClick,this)},e.prototype.removeListener=function(){Utility.ButtonActive2(this.closeBtn,!1),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnClick,this),Utility.ButtonActive2(this.bottomLeftBtn,!1),this.bottomLeftBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bottomLeftBtnClick,this),Utility.ButtonActive2(this.bottomRightBtn,!1),this.bottomRightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.bottomRightBtnClick,this)},e.prototype.closeBtnClick=function(){AudioManager.Instance.PlaySound("btnback_wav"),SceneManager.Instance.popScene()},e.prototype.bottomLeftBtnClick=function(){1!=this.pageIndex&&(this.pageIndex-=1,this.RefreshLevelDatas())},e.prototype.bottomRightBtnClick=function(){this.pageIndex!=this.pageMax&&(this.pageIndex+=1,this.RefreshLevelDatas())},e}(Scene);__reflect(SelectLevelScene.prototype,"SelectLevelScene");var LevelGrid=function(){function t(t,e,i){this.scene=t,this._width=e,this._height=i}return t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.InitDataUI=function(t,e){var i=String(e);if(null==t.getChildByName("btn")){var n=Utility.createButton("btn4_png",this._width,this._height,!0);n.name="btn",n.x=this._width/2,n.y=this._height/2;var r=Utility.createTextField(this._width,this._height,16777215,40,i);r.name="levelTxt",r.textAlign=egret.HorizontalAlign.CENTER,n.addChild(r),t.addChild(n),this.scene.addBtnEventListener(n)}else{var n=t.getChildByName("btn"),r=n.getChildByName("levelTxt");r.text=i}},t.prototype.Destroy=function(t){},t}();__reflect(LevelGrid.prototype,"LevelGrid",["IScrollViewGrid"]);var ShopScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.datas1=[],e.datas2=[],e.datas3=[],e.togLen=3,e.togIndex=0,e.togBgColors=["#513007","#D3A74F"],e.togIconColors=["#B48B5D","#FFFFFF"],e.togFuncs=[],e.TubeThemeSpacing=30,e}return __extends(e,t),e.prototype.onComplete=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.togIndex=-1;var i=0;null!=t[0]&&(i=t[0]),this.InitBG(),this.InitDiamons(),this.InitTitleTXT(),this.InitCloseBtn(),this.InitTopTogs(),this.InitScrollView(),this.InitGrid(),this.InitDatas(),this.OnTogClick(i)},e.prototype.InitBG=function(){null==this.bg&&(this.bg=this.createBitmapByName("bg_1_png"),this.bg.fillMode=egret.BitmapFillMode.SCALE,this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg))},e.prototype.InitDiamons=function(){var t="icon1_png",e=PlayerData.Instance.GetDiamons(GameType.Normal),i="icon10_png",n=PlayerData.Instance.GetDiamons(GameType.Difficult);null==this.diamonLayout1?(this.diamonLayout1=GameUtil.createDiamonLayout(t,e),this.diamonLayout1.x=30,this.diamonLayout1.y=30,this.addChild(this.diamonLayout1)):GameUtil.changeDiamonIconAndNum(this.diamonLayout1,t,e),null==this.diamonLayout2?(this.diamonLayout2=GameUtil.createDiamonLayout(i,n),this.diamonLayout2.x=30,this.diamonLayout2.y=100,this.addChild(this.diamonLayout2)):GameUtil.changeDiamonIconAndNum(this.diamonLayout2,i,n)},e.prototype.InitTitleTXT=function(){if(null==this.titleTXT){var t="商店";this.titleTXT=this.createTextField(300,60,16777215,42,t),this.titleTXT.textAlign=egret.HorizontalAlign.CENTER,this.titleTXT.x=SceneManager.ScreenWidth/2-this.titleTXT.width/2,this.titleTXT.y=30,this.addChild(this.titleTXT)}},e.prototype.InitCloseBtn=function(){if(null==this.closeBtn){var t=70;this.closeBtn=this.createBitmapByName("close2_png"),this.closeBtn.fillMode=egret.BitmapFillMode.SCALE,this.closeBtn.width=60,this.closeBtn.height=60,this.closeBtn.x=SceneManager.ScreenWidth-this.closeBtn.width-30,this.closeBtn.y=t,this.addChild(this.closeBtn)}},e.prototype.InitTopTogs=function(){if(null==this.topTogs){this.topTogs=[];for(var t=this.togLen,e=50,i=5,n=(SceneManager.ScreenWidth-2*e-(t-1)*i)/3,r=60,s=.25*SceneManager.ScreenHeight-70,h=0;t>h;h++){var a="tog1_png";a=0==h?"tog1_png":h==t-1?"tog3_png":"tog2_png";var o=this.createButton(a,n,r);o.x=e+(n+i)*h,o.y=s;var l=o.getChildByName("btnBg");Utility.setImageColor(l,Utility.ColorHTMLToInt(this.togBgColors[0]));var c=this.createBitmapByName("tog_icon"+(h+1)+"_png",54,54,!0);Utility.setImageColor(c,Utility.ColorHTMLToInt(this.togIconColors[0])),c.name="icon",c.x=n/2,c.y=r/2,o.addChild(c),this.addChild(o),this.topTogs.push(o)}}},e.prototype.InitScrollView=function(){if(null==this.scrollView){var t=SceneManager.ScreenWidth-120,e=SceneManager.ScreenHeight/2,i=t/2,n=e/2,r=SceneManager.ScreenWidth/2,s=SceneManager.ScreenHeight/2+30;this.scrollView=new LzyScrollView(!0,t,e,r,s,i,n,"empty_png"),this.scrollView.name="diamonSV",this.addChild(this.scrollView)}if(null==this.scrollView2){var t=SceneManager.ScreenWidth-120,e=SceneManager.ScreenHeight/2,i=t/2,n=e/2,r=SceneManager.ScreenWidth/2,s=SceneManager.ScreenHeight/2+30;this.scrollView2=new LzyScrollView(!0,t,e,r,s,i,n,"empty_png"),this.scrollView2.name="skinSV",this.addChild(this.scrollView2)}},e.prototype.SetScrollView=function(t){0==t?(null==this.getChildByName("diamonSV")&&this.addChild(this.scrollView),null!=this.getChildByName("skinSV")&&this.removeChild(this.scrollView2)):(null!=this.getChildByName("diamonSV")&&this.removeChild(this.scrollView),null==this.getChildByName("skinSV")&&this.addChild(this.scrollView2))},e.prototype.InitGrid=function(){if(null==this.diamonGrid){var t=this.scrollView.width,e=120;this.diamonGrid=new DiamonGrid(this,t,e);var i=this.TubeThemeSpacing,n=0,r=(t-n+i)/2-i,s=r;this.tubeGrid=new TubeThemeGrid(this,r,s)}},e.prototype.InitDatas=function(){if(0==this.datas1.length)for(var t=DataConfig.Instance.GetConfig("purchaser"),e=t.length,i=0;e>i;i++){var n=t[i],r=new DiamonData;r.configId=n.ID,r.config=n,r.isGot=!1,1==n.Type&&(r.isGot=PlayerData.Instance.noAds),this.datas1.push(r)}else for(var s=this.datas1.length,i=0;s>i;i++){var r=this.datas1[i],h=r.configId;r.isGot=!1,1==r.config.Type&&(r.isGot=PlayerData.Instance.noAds)}if(0==this.datas2.length)for(var a=DataConfig.Instance.GetConfig("tube"),o=a.length,i=0;o>i;i++){var n=a[i],r=new TubeThemeData,h=n.ID;r.configId=h,r.config=n,r.isTube=!0,r.isUsed=PlayerData.Instance.curTubeID==h,r.isOwn=PlayerData.Instance.isTubeContains(h),this.datas2.push(r)}else for(var o=this.datas2.length,i=0;o>i;i++){var r=this.datas2[i],h=r.configId;r.isUsed=PlayerData.Instance.curTubeID==h,r.isOwn=PlayerData.Instance.isTubeContains(h)}if(0==this.datas3.length)for(var l=DataConfig.Instance.GetConfig("theme"),c=l.length,i=0;c>i;i++){var n=l[i],r=new TubeThemeData,h=n.ID;r.configId=h,r.config=n,r.isTube=!1,r.isUsed=PlayerData.Instance.curThemeID==h,r.isOwn=PlayerData.Instance.isThemeContains(h),this.datas3.push(r)
}else for(var c=this.datas3.length,i=0;c>i;i++){var r=this.datas3[i],h=r.configId;r.isUsed=PlayerData.Instance.curThemeID==h,r.isOwn=PlayerData.Instance.isThemeContains(h)}},e.prototype.OnTogClick=function(t){if(null!=this.topTogs[t]&&this.togIndex!=t){var e=this.topTogs[t],i=e.getChildByName("btnBg");Utility.setImageColor(i,Utility.ColorHTMLToInt(this.togBgColors[1]));var n=e.getChildByName("icon");if(Utility.setImageColor(n,Utility.ColorHTMLToInt(this.togIconColors[1])),this.togIndex>=0){var r=this.topTogs[this.togIndex],s=r.getChildByName("btnBg");Utility.setImageColor(s,Utility.ColorHTMLToInt(this.togBgColors[0]));var h=r.getChildByName("icon");Utility.setImageColor(h,Utility.ColorHTMLToInt(this.togIconColors[0]))}this.togIndex=t;var a=this.TubeThemeSpacing;0==t?this.scrollView.SetContent(0,10,this.datas1,this.diamonGrid,0,0):1==t?this.scrollView2.SetContent(a,a,this.datas2,this.tubeGrid):2==t&&this.scrollView2.SetContent(a,a,this.datas3,this.tubeGrid),this.SetScrollView(t)}},e.prototype.addDiamonEventListener=function(t){Utility.ButtonActive(t,!0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.DiamonClick.bind(this,t),this)},e.prototype.addTubeClickListener=function(t){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.TubeThemeClick.bind(this,t),this)},e.prototype.Update=function(){},e.prototype.addListener=function(){Utility.ButtonActive2(this.closeBtn,!0),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnClick,this);for(var t=this.togLen,e=0;t>e;e++)this.togFuncs[e]=this.togClick.bind(this,e),this.topTogs[e].touchEnabled=!0,this.topTogs[e].addEventListener(egret.TouchEvent.TOUCH_TAP,this.togFuncs[e],this)},e.prototype.removeListener=function(){Utility.ButtonActive2(this.closeBtn,!1),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBtnClick,this);for(var t=this.togLen,e=0;t>e;e++)this.topTogs[e].touchEnabled=!1,this.topTogs[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.togFuncs[e],this)},e.prototype.closeBtnClick=function(){AudioManager.Instance.PlaySound("btnback_wav"),SceneManager.Instance.popScene()},e.prototype.togClick=function(t){console.log("index",t),this.OnTogClick(t)},e.prototype.DiamonClick=function(t){console.log(t.parent.name);var e=Number(t.name),i=this.datas1[e];i.config.Type},e.prototype.TubeThemeClick=function(t){if(console.log(t.name),1==this.togIndex){Number(t.name)}},e}(Scene);__reflect(ShopScene.prototype,"ShopScene");var DiamonData=function(){function t(){}return t}();__reflect(DiamonData.prototype,"DiamonData");var DiamonGrid=function(){function t(t,e,i){this.scene=t,this._width=e,this._height=i,this.parser=new egret.HtmlTextParser}return t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.InitDataUI=function(t,e){if(null==t.getChildByName("itemBg")){var i=Utility.createBitmapByName("di3_png",this._width,this._height);i.name="itemBg",t.addChild(i)}var n=e.config.Icon;if(null==t.getChildByName("purchaserIcon")){var r=.75*this._height,s=.75*this._height,h=Utility.createBitmapByName(n,r,s,!0);h.x=this._height/2,h.y=this._height/2,h.name="purchaserIcon",t.addChild(h)}else{var h=t.getChildByName("purchaserIcon");h.texture=RES.getRes(n)}var a=140,o=40,l=this.parser.parse(e.config.Desc);if(null==t.getChildByName("descTxt")){var r=this._width-this._height-o-a,c=Utility.createTextField(r,this._height,16777215,26,"","myFirstFont");c.textFlow=l,c.x=this._height,c.name="descTxt",t.addChild(c)}else{var c=t.getChildByName("descTxt");c.textFlow=l}var u=e.config.PriceIcon,d=e.config.Price,g=e.config.BtnColor;if(null==t.getChildByName("btn")){var r=a,s=50,p=Utility.createButton("di4_png",r,s,!0),f=p.getChildByName("btnBg");0==e.isGot?Utility.setImageColor(f,Utility.ColorHTMLToInt(g)):Utility.setImageColor(f,Utility.ColorHTMLToInt("#AEAEAE")),p.name="btn",p.x=this._width-p.width/2-o,p.y=this._height/2,t.addChild(p),this.scene.addDiamonEventListener(p);var m=Utility.createBitmapByName(u,32,32,!0);m.name="priceIcon",m.x=8+m.width/2,m.y=s/2,p.addChild(m);var y=r-8-m.width-8,v=Utility.createTextField(y,s,16777215,26,d,"myFirstFont");v.textAlign=egret.HorizontalAlign.LEFT,v.name="priceTxt",v.x=8+m.width+8,v.y=0,p.addChild(v)}else{var p=t.getChildByName("btn"),f=p.getChildByName("btnBg");0==e.isGot?Utility.setImageColor(f,Utility.ColorHTMLToInt(g)):Utility.setImageColor(f,Utility.ColorHTMLToInt("#AEAEAE"));var m=p.getChildByName("priceIcon");m.texture=RES.getRes(u);var v=p.getChildByName("priceTxt");v.text=d}},t.prototype.Destroy=function(t){},t}();__reflect(DiamonGrid.prototype,"DiamonGrid",["IScrollViewGrid"]);var TubeThemeData=function(){function t(){}return t}();__reflect(TubeThemeData.prototype,"TubeThemeData");var TubeThemeGrid=function(){function t(t,e,i){this.scene=t,this._width=e,this._height=i}return t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.InitDataUI=function(t,e){if(null==t.getChildByName("itemBg")){var i=Utility.createBitmapByName("di3_png",this._width,this._height);i.name="itemBg",t.addChild(i),this.scene.addTubeClickListener(t)}var n=(e.isTube,e.isTube?e.config.eftSprite:e.config.ShowSprite);if(null==t.getChildByName("icon")){var r=.6*this._width,s=r,h=Utility.createBitmapByName(n,r,s,!0);h.name="icon",h.x=this._width/2,h.y=this._height/2-30,t.addChild(h)}else{var h=t.getChildByName("icon");h.texture=RES.getRes(n)}var a=e.isOwn,o=e.isUsed;if(null==t.getChildByName("lock")){var r=42,s=r,l=Utility.createBitmapByName("lock_png",r,s);l.x=15,l.y=15,l.name="lock",l.alpha=a?0:1,t.addChild(l)}else{var l=t.getChildByName("lock");l.alpha=a?0:1}if(null==t.getChildByName("check")){var r=100,s=r,c=Utility.createBitmapByName("check_png",r,s,!0);c.name="check",c.x=this._width/2,c.y=this._height-40,c.alpha=o?1:0,t.addChild(c)}else{var c=t.getChildByName("check");c.alpha=o?1:0}if(null==t.getChildByName("txt")){var r=this._width,s=50,u=Utility.createTextField(r,s,16777215,26,"可以使用","myFirstFont");u.textAlign=egret.HorizontalAlign.CENTER,u.name="txt",u.x=0,u.y=this._height-s,u.alpha=o?0:a?1:0,t.addChild(u)}else{var u=t.getChildByName("txt");u.alpha=o?0:a?1:0}var d=e.config.CostType,g=1==d?"icon1_png":"icon10_png",p=String(e.config.Cost);if(null==t.getChildByName("cost")){var r=.5*this._width,s=40,f=Utility.createButton("di_png",r,s,!0);f.name="cost",f.x=this._width/2,f.y=this._height-40;var m=Utility.createBitmapByName(g,50,50,!0);m.name="costIcon",m.x=10,m.y=f.height/2,f.addChild(m);var y=Utility.createTextField(r,s,16777215,24,p,"myFirstFont");y.textAlign=egret.HorizontalAlign.CENTER,y.name="costTxt",f.addChild(y),t.addChild(f),f.scaleX=a?0:1,f.scaleY=a?0:1}else{var f=t.getChildByName("cost"),m=f.getChildByName("costIcon");m.texture=RES.getRes(g);var y=f.getChildByName("costTxt");y.text=p,f.scaleX=a?0:1,f.scaleY=a?0:1}},t.prototype.Destroy=function(t){},t}();__reflect(TubeThemeGrid.prototype,"TubeThemeGrid",["IScrollViewGrid"]);var StartScene=function(t){function e(){var e=t.call(this)||this;return e.bottomNames=["关卡","排行","商店","分享"],e.bottomRess=["menu_png","rank_png","shop_png","share_png"],e.bottomBtn=[],e.bottomFunc=[],e}return __extends(e,t),e.prototype.onComplete=function(){this.gameType=GameType.Normal,null==this.bg&&(this.bg=this.createBitmapByName("bg_1_png"),this.bg.width=SceneManager.ScreenWidth,this.bg.height=SceneManager.ScreenHeight,this.addChild(this.bg)),null==this.icon&&(this.icon=this.createBitmapByName("icon_png"),this.icon.fillMode=egret.BitmapFillMode.SCALE,this.icon.width=500,this.icon.height=370,this.icon.anchorOffsetX=this.icon.width/2,this.icon.anchorOffsetY=this.icon.height/2,this.icon.x=SceneManager.ScreenWidth/2,this.icon.y=SceneManager.ScreenHeight/2-SceneManager.ScreenHeight/4,this.addChild(this.icon)),null==this.textfield&&(this.textfield=new egret.TextField,this.textfield.text="WaterPuzzle",this.textfield.fontFamily="myFirstFont",this.textfield.textColor=65535,this.textfield.textAlign=egret.HorizontalAlign.CENTER,this.textfield.verticalAlign=egret.VerticalAlign.MIDDLE,this.textfield.width=SceneManager.ScreenWidth,this.textfield.height=400,this.textfield.anchorOffsetX=this.textfield.width/2,this.textfield.anchorOffsetY=this.textfield.height/2,this.textfield.x=SceneManager.ScreenWidth/2,this.textfield.y=SceneManager.ScreenHeight/2,this.textfield.size=100,this.addChild(this.textfield)),this.level=PlayerData.Instance.GetCurLevel(this.gameType);var t="LEVEL "+String(this.level);null==this.levelTxt?(this.levelTxt=this.createTextField(400,200,16777215,30,t),this.levelTxt.textAlign=egret.HorizontalAlign.CENTER,this.levelTxt.anchorOffsetX=this.levelTxt.width/2,this.levelTxt.anchorOffsetY=this.levelTxt.height/2,this.levelTxt.x=SceneManager.ScreenWidth/2,this.levelTxt.y=SceneManager.ScreenHeight/2+100,this.levelTxt.size=30,this.addChild(this.levelTxt)):this.levelTxt.text=t,null==this.startBtn&&(this.startBtn=this.createButton("start_btn_png",230,120),this.startBtn.anchorOffsetX=this.startBtn.width/2,this.startBtn.anchorOffsetY=this.startBtn.height/2,this.startBtn.x=SceneManager.ScreenWidth/2,this.startBtn.y=SceneManager.ScreenHeight/2+230,this.addChild(this.startBtn)),this.InitBottom()},e.prototype.InitBottom=function(){for(var t=this.bottomNames.length,e=0;t>e;e++)this.InitBottomButton(e,t)},e.prototype.InitBottomButton=function(t,e){if(null==this.bottomBtn[t]){var i=this.bottomRess[t],n=this.bottomNames[t],r=this.createButton(i,100,100);r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.x=SceneManager.ScreenWidth/(e+1)*(t+1),r.y=SceneManager.ScreenHeight-240;var s=this.createTextField(200,100,16777215,30,n);s.textAlign=egret.HorizontalAlign.CENTER,s.x=-r.width/2,s.y=r.height/2,r.addChild(s),this.addChild(r),this.bottomBtn[t]=r}},e.prototype.Update=function(){},e.prototype.OnTouch=function(){AudioManager.Instance.PlaySound("mainBtn_wav"),SceneManager.Instance.changeScene("GameScene")},e.prototype.onClickBottom=function(t,e){console.log(t),0==t?SceneManager.Instance.pushScene("SelectLevelScene",this.gameType):1==t?SceneManager.Instance.pushScene("RankScene"):2==t&&SceneManager.Instance.pushScene("ShopScene",0)},e.prototype.addListener=function(){Utility.ButtonActive(this.startBtn,!0),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouch,this);for(var t=this.bottomBtn.length,e=0;t>e;e++){var i=this.onClickBottom.bind(this,e);this.bottomFunc[e]=i,Utility.ButtonActive(this.bottomBtn[e],!0),this.bottomBtn[e].addEventListener(egret.TouchEvent.TOUCH_TAP,i,this)}},e.prototype.removeListener=function(){Utility.ButtonActive(this.startBtn,!1),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTouch,this);for(var t=this.bottomBtn.length,e=0;t>e;e++){var i=this.bottomFunc[e];Utility.ButtonActive(this.bottomBtn[e],!1),this.bottomBtn[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,i,this)}},e}(Scene);__reflect(StartScene.prototype,"StartScene");